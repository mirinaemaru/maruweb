# Trading 모듈 사용 매뉴얼

> 작성일: 2026-01-13
> 버전: 2.0
> 변경사항: 퀵 스타트 가이드 추가, 실행 이력/고급 분석 섹션 추가, API 연동 가이드 추가, FAQ 확장

---

## 목차

1. [시작하기](#1-시작하기)
2. [퀵 스타트 가이드](#2-퀵-스타트-가이드)
3. [대시보드](#3-대시보드)
4. [계좌 관리](#4-계좌-관리)
5. [주문/체결 관리](#5-주문체결-관리)
6. [포지션 관리](#6-포지션-관리)
7. [전략 관리](#7-전략-관리)
8. [자동매매 설정](#8-자동매매-설정)
9. [실행 이력](#9-실행-이력)
10. [백테스트](#10-백테스트)
11. [고급 분석](#11-고급-분석)
12. [전략 최적화](#12-전략-최적화)
13. [리스크 관리](#13-리스크-관리)
14. [알림 설정](#14-알림-설정)
15. [유틸리티](#15-유틸리티)
16. [API 연동 가이드](#16-api-연동-가이드)
17. [FAQ 및 문제 해결](#17-faq-및-문제-해결)
18. [부록](#18-부록)

---

## 1. 시작하기

### 1.1 접속 방법

**URL**: `http://localhost:8090/trading`

사이드바 메뉴에서 **Trading** 을 클릭하여 접속합니다.

### 1.2 사전 요구사항

| 항목 | 설명 |
|------|------|
| Maruweb 서버 | 포트 8090에서 실행 중 |
| Trading System API | 포트 8099에서 실행 중 |
| 환경 설정 | `.env` 파일에 `TRADING_API_BASE_URL` 설정 |

### 1.3 서버 시작

```bash
# Maruweb 서버 시작
./run-maruweb.sh

# 로그 확인
tail -f /tmp/maruweb.log

# 서버 중지
./stop-maruweb.sh
```

### 1.4 메뉴 구조

```
Trading
├── 대시보드 (/trading)
├── 계좌 관리
│   ├── 계좌 목록 (/trading/accounts)
│   └── 잔고 조회 (/trading/balances)
├── 주문/체결
│   ├── 주문 목록 (/trading/orders)
│   ├── 체결 내역 (/trading/fills)
│   └── 실행 이력 (/trading/execution-history)
├── 포지션 (/trading/positions)
├── 전략 관리 (/trading/strategies)
├── 백테스트
│   ├── 백테스트 목록 (/trading/backtests)
│   ├── 백테스트 실행 (/trading/backtests/run)
│   ├── 포트폴리오 백테스트 (/trading/portfolio-backtest)
│   ├── Walk-Forward 분석 (/trading/walk-forward-analysis)
│   └── 전략 최적화 (/trading/optimization)
├── 리스크 관리
│   ├── 리스크 규칙 (/trading/risk-rules)
│   ├── 킬 스위치 (/trading/kill-switch)
│   ├── VaR 분석 (/trading/risk/var)
│   └── 상관관계 분석 (/trading/risk/correlation)
├── 성과 분석 (/trading/performance)
├── 알림 설정 (/trading/notifications/settings)
├── 종목 관리 (/trading/instruments)
└── 헬스 체크 (/trading/health-check)
```

---

## 2. 퀵 스타트 가이드

### 2.1 5분 만에 시작하기

**Step 1: 시스템 상태 확인**
```
1. `/trading` 접속
2. 대시보드 상단의 "Trading API" 상태 확인 (녹색: 연결됨)
3. 빨간색이면 → API 서버 실행 여부 확인
```

**Step 2: 첫 번째 계좌 등록**
```
1. `/trading/accounts` 접속
2. "신규 계좌" 버튼 클릭
3. 증권사, 계좌번호, 별칭 입력
4. "저장" 클릭
```

**Step 3: 첫 번째 전략 만들기**
```
1. `/trading/strategies` 접속
2. "새 전략" 버튼 클릭
3. 전략명 입력 (예: "RSI 역추세")
4. 전략 유형: "AUTO_TRADING" 선택
5. "저장" 클릭
```

**Step 4: 자동매매 조건 설정**
```
1. 생성된 전략의 "Configure Trading" 클릭
2. 대상 계좌 선택
3. 종목 코드 입력 (예: 005930)
4. 진입/청산 조건 설정
5. "저장" 클릭
```

**Step 5: 전략 활성화**
```
1. 전략 목록으로 돌아가기
2. "Sync" 버튼 클릭 → 동기화 완료 확인
3. "Activate" 버튼 클릭 → 자동매매 시작!
```

### 2.2 첫 번째 백테스트 실행

```
1. `/trading/backtests/run` 접속
2. 테스트할 전략 선택
3. 기간 설정: 시작일 ~ 종료일
4. 초기 자본 입력 (예: 10,000,000원)
5. "실행" 클릭
6. 결과 확인: 수익률, MDD, 샤프비율
```

### 2.3 긴급 상황 대응

**모든 자동매매 즉시 중단:**
```
1. `/trading/kill-switch` 접속
2. "킬 스위치 활성화" 버튼 클릭
3. 확인 대화상자에서 "확인"
→ 모든 자동매매가 즉시 중단됩니다
```

---

## 3. 대시보드

### 3.1 개요

대시보드는 Trading 시스템의 전체 현황을 한눈에 파악할 수 있는 페이지입니다.

### 3.2 주요 구성 요소

| 섹션 | 설명 |
|------|------|
| 시스템 상태 | Trading API 연결 상태 표시 (녹색: 연결됨, 빨간색: 연결 안됨) |
| 킬 스위치 상태 | 현재 킬 스위치 활성화 여부 |
| 계좌 요약 | 총 잔고, 사용 가능 금액, 총 손익 |
| 전략 현황 | 전체 전략 수, 활성화된 전략 수 |
| 오늘의 거래 | 오늘 주문/체결 수, 손익 |
| 최근 활동 | 최근 주문, 체결, 알림 목록 |

### 3.3 상태 아이콘

| 아이콘/색상 | 의미 |
|------------|------|
| 녹색 | 정상/연결됨/활성 |
| 빨간색 | 오류/연결 안됨/비활성 |
| 노란색 | 경고/주의 필요 |
| 회색 | 비활성/대기 중 |

### 3.4 바로가기 버튼

대시보드에서 자주 사용하는 기능으로 빠르게 이동할 수 있습니다:
- 계좌 관리
- 전략 관리
- 주문 목록
- 헬스 체크

---

## 4. 계좌 관리

### 4.1 계좌 목록 조회

**경로**: `/trading/accounts`

등록된 모든 거래 계좌를 조회합니다.

| 컬럼 | 설명 |
|------|------|
| 계좌번호 | 증권사 계좌번호 |
| 계좌명 | 사용자 정의 이름 |
| 증권사 | 연결된 증권사 |
| 환경 | 실계좌(REAL)/모의계좌(VIRTUAL) |
| 상태 | 활성(ACTIVE)/비활성(INACTIVE) |

### 4.2 계좌 등록

1. 계좌 목록에서 **"신규 계좌"** 버튼 클릭
2. 필수 정보 입력:
   - **증권사**: 한국투자증권, 키움증권 등
   - **계좌번호 (CANO)**: 8자리 계좌번호
   - **상품코드 (ACNT_PRDT_CD)**: 2자리 (보통 01)
   - **별칭**: 계좌 식별용 이름
   - **환경**: REAL(실거래) / VIRTUAL(모의)
3. **"저장"** 버튼 클릭

### 4.3 계좌 상세/수정

1. 계좌 목록에서 계좌 클릭
2. 상세 정보 확인
3. **"수정"** 버튼으로 편집 모드 진입
4. 정보 수정 후 **"저장"**

### 4.4 계좌 상태 변경

- **활성화**: 계좌를 거래에 사용할 수 있음
- **비활성화**: 계좌의 모든 거래 중단

### 4.5 잔고 조회

**경로**: `/trading/balances`

계좌별 상세 잔고 정보를 조회합니다:

| 항목 | 설명 |
|------|------|
| 예수금 | 계좌 내 현금 |
| 증거금 | 거래에 필요한 담보금 |
| 사용 가능 금액 | 실제 매매에 사용 가능한 금액 |
| 출금 가능 금액 | 출금 가능한 금액 |
| 총 평가 금액 | 현금 + 보유 주식 평가액 |

---

## 5. 주문/체결 관리

### 5.1 주문 목록

**경로**: `/trading/orders`

#### 필터 옵션

| 필터 | 설명 | 예시 |
|------|------|------|
| 계좌 | 특정 계좌 선택 | 선택 필수 |
| 상태 | 대기중, 체결완료, 부분체결, 취소 | PENDING, FILLED |
| 기간 | 시작일 ~ 종료일 | 2026-01-01 ~ 2026-01-13 |
| 종목 | 특정 종목 코드 | 005930 |
| 매수/매도 | BUY / SELL | BUY |

#### 주문 정보

| 항목 | 설명 |
|------|------|
| 주문번호 | 고유 식별자 |
| 종목 | 주문 종목 코드 및 이름 |
| 유형 | 매수(BUY)/매도(SELL) |
| 주문 유형 | 지정가(LIMIT)/시장가(MARKET) |
| 가격 | 주문 가격 |
| 수량 | 주문 수량 |
| 체결 수량 | 실제 체결된 수량 |
| 상태 | 현재 주문 상태 |
| 주문 시간 | 주문 생성 시간 |

### 5.2 주문 취소/수정

**주문 취소**:
1. 주문 목록에서 대기 중인 주문 선택
2. **"취소"** 버튼 클릭
3. 확인 대화상자에서 **"확인"**

**주문 수정**:
1. 주문 목록에서 대기 중인 주문 선택
2. **"수정"** 버튼 클릭
3. 새 가격/수량 입력
4. **"저장"** 클릭

> 체결 완료된 주문은 취소/수정할 수 없습니다.

### 5.3 체결 내역

**경로**: `/trading/fills`

체결된 거래의 상세 내역을 조회합니다:

| 항목 | 설명 |
|------|------|
| 체결번호 | 체결 고유 식별자 |
| 주문번호 | 연결된 주문 번호 |
| 종목 | 체결 종목 |
| 체결 가격 | 실제 체결된 가격 |
| 체결 수량 | 체결된 수량 |
| 체결 금액 | 체결 가격 x 수량 |
| 수수료 | 거래 수수료 |
| 세금 | 거래세 |
| 체결 시간 | 체결 완료 시간 |

### 5.4 Excel 내보내기

주문 목록 또는 체결 내역을 Excel 파일로 내보낼 수 있습니다:
1. 필터 조건 설정 (선택사항)
2. **"Excel 내보내기"** 버튼 클릭
3. 파일 자동 다운로드

---

## 6. 포지션 관리

### 6.1 포지션 목록

**경로**: `/trading/positions`

현재 보유 중인 모든 포지션을 조회합니다.

| 항목 | 설명 |
|------|------|
| 종목 | 보유 종목 코드 및 이름 |
| 수량 | 보유 수량 |
| 평균 매입가 | 평균 매수 가격 |
| 현재가 | 실시간 현재 가격 |
| 평가 금액 | 현재 평가 금액 (현재가 x 수량) |
| 손익 | 미실현 손익 금액 |
| 수익률 | 손익률 (%) |

### 6.2 손익 색상 표시

| 색상 | 의미 |
|------|------|
| 빨간색/상승 | 수익 (양수) |
| 파란색/하락 | 손실 (음수) |
| 검정색 | 변동 없음 |

### 6.3 포지션 상세

포지션을 클릭하면 상세 정보를 확인할 수 있습니다:
- 매수 이력 (언제, 얼마에, 몇 주)
- 평균 단가 계산 내역
- 관련 주문 목록
- 손익 추이 그래프

---

## 7. 전략 관리

### 7.1 전략 목록

**경로**: `/trading/strategies`

등록된 모든 전략을 조회합니다.

### 7.2 전략 유형

| 유형 | 설명 | 기능 |
|------|------|------|
| **GENERAL** | 일반 전략 | 메모, 기록 용도. 백테스트 가능 |
| **AUTO_TRADING** | 자동매매 전략 | 조건 기반 자동 매매 실행 |

### 7.3 전략 생성

1. **"새 전략"** 버튼 클릭
2. 기본 정보 입력:

| 필드 | 설명 | 필수 |
|------|------|------|
| 전략명 | 전략을 식별하는 이름 | O |
| 설명 | 전략에 대한 상세 설명 | - |
| 전략 유형 | GENERAL / AUTO_TRADING | O |
| 카테고리 | 분류 카테고리 | - |

3. **"저장"** 클릭

### 7.4 전략 상태 (AUTO_TRADING)

| 상태 | 설명 |
|------|------|
| `NOT_SYNCED` | Trading API에 동기화되지 않음 |
| `SYNCED` | 동기화 완료, 활성화 대기 |
| `OUT_OF_SYNC` | 로컬 변경사항 있음 (재동기화 필요) |
| `ERROR` | 동기화 중 오류 발생 |

### 7.5 전략 버튼 설명 (AUTO_TRADING)

| 버튼 | 설명 | 조건 |
|------|------|------|
| **Configure Trading** | 자동매매 조건 설정 페이지로 이동 | 항상 가능 |
| **Sync** | Trading System API에 전략 동기화 | 설정 완료 시 |
| **Activate** | 자동매매 활성화 | 동기화 완료 시 |
| **Deactivate** | 자동매매 비활성화 | 활성화 상태 시 |
| **Monitor** | 실시간 모니터링 대시보드 | 활성화 상태 시 |

### 7.6 카테고리 관리

전략을 분류하기 위한 카테고리를 관리합니다:
- 카테고리 추가: 전략 목록 상단 "카테고리 관리"
- 카테고리 삭제: 해당 카테고리의 전략이 없을 때만 가능

---

## 8. 자동매매 설정

### 8.1 설정 페이지

**경로**: `/trading/strategies/{id}/trading`

AUTO_TRADING 전략에서 **"Configure Trading"** 클릭

### 8.2 기본 설정

| 항목 | 설명 | 예시 |
|------|------|------|
| 대상 계좌 | 매매에 사용할 계좌 선택 | 필수 |
| 종목 코드 | 매매 대상 종목 | 005930 (삼성전자) |
| 자산 유형 | 주식/선물/옵션 등 | STOCK |

### 8.3 진입 조건 설정

JSON 형식으로 조건을 입력합니다:

```json
[
  {
    "type": "PRICE",
    "operator": ">=",
    "value": 70000,
    "description": "가격이 70,000원 이상일 때"
  },
  {
    "type": "RSI",
    "operator": "<=",
    "value": 30,
    "period": 14,
    "description": "RSI(14)가 30 이하일 때 (과매도)"
  }
]
```

#### 지원 조건 타입

| 타입 | 설명 | 추가 파라미터 |
|------|------|--------------|
| `PRICE` | 가격 조건 | - |
| `VOLUME` | 거래량 조건 | - |
| `MA` | 이동평균 조건 | `period` (기간) |
| `RSI` | RSI 지표 조건 | `period` (기간) |
| `MACD` | MACD 지표 조건 | `fast`, `slow`, `signal` |
| `BOLLINGER` | 볼린저 밴드 조건 | `period`, `std` |

#### 지원 연산자

| 연산자 | 설명 | 예시 |
|--------|------|------|
| `>` | 초과 | 가격 > 70000 |
| `>=` | 이상 | RSI >= 70 |
| `<` | 미만 | RSI < 30 |
| `<=` | 이하 | 가격 <= 50000 |
| `==` | 같음 | 상태 == "과매도" |
| `cross_up` | 상향 돌파 | 가격 cross_up MA(20) |
| `cross_down` | 하향 돌파 | 가격 cross_down MA(20) |

### 8.4 청산 조건 설정

진입 조건과 동일한 형식으로 청산 조건을 설정합니다:

```json
[
  {
    "type": "RSI",
    "operator": ">=",
    "value": 70,
    "period": 14,
    "description": "RSI(14)가 70 이상일 때 (과매수)"
  }
]
```

### 8.5 리스크 관리 설정

| 항목 | 설명 | 옵션 | 예시 |
|------|------|------|------|
| 손절 유형 | 손절 기준 방식 | PERCENT / FIXED | PERCENT |
| 손절 값 | 손절 기준 값 | 숫자 | 5 (5% 손실 시 손절) |
| 익절 유형 | 익절 기준 방식 | PERCENT / FIXED | PERCENT |
| 익절 값 | 익절 기준 값 | 숫자 | 10 (10% 수익 시 익절) |

### 8.6 포지션 크기 설정

| 항목 | 설명 | 옵션 | 예시 |
|------|------|------|------|
| 크기 유형 | 투자 방식 | FIXED / PERCENT / RISK_BASED | PERCENT |
| 크기 값 | 투자 비율/금액 | 숫자 | 10 (가용 자금의 10%) |
| 최대 포지션 | 최대 보유 가능 포지션 수 | 숫자 | 3개 |

### 8.7 동기화 및 활성화 워크플로우

```
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│ 설정 완료    │───▶│   Sync     │───▶│  Activate  │
│ (저장)       │    │ (동기화)    │    │ (활성화)    │
└─────────────┘    └─────────────┘    └─────────────┘
                         │                   │
                         ▼                   ▼
                   NOT_SYNCED → SYNCED → ACTIVE
```

1. 설정 완료 후 **"저장"** 클릭
2. 전략 목록으로 돌아가서 **"Sync"** 클릭
3. 동기화 성공 확인 (`syncStatus: SYNCED`)
4. **"Activate"** 클릭하여 자동매매 시작

---

## 9. 실행 이력

### 9.1 개요

**경로**: `/trading/execution-history`

주문 실행 과정의 상세 타임라인을 확인합니다.

### 9.2 실행 이력 정보

| 항목 | 설명 |
|------|------|
| 실행 ID | 고유 식별자 |
| 주문 ID | 연결된 주문 |
| 생성 시간 | 주문 생성 시점 |
| 전송 시간 | 증권사 전송 시점 |
| 응답 시간 | 증권사 응답 시점 |
| 체결 시간 | 최종 체결 시점 |
| 소요 시간 | 전체 소요 시간 |
| 슬리피지 | 주문가격 대비 체결가격 차이 |

### 9.3 슬리피지 분석

슬리피지는 주문 가격과 실제 체결 가격의 차이입니다:

| 상태 | 의미 |
|------|------|
| 양수 | 불리한 체결 (매수 시 비싸게, 매도 시 싸게) |
| 음수 | 유리한 체결 (매수 시 싸게, 매도 시 비싸게) |
| 0 | 정확한 체결 |

### 9.4 필터 옵션

- 계좌 선택
- 날짜 범위
- 종목 코드
- 최소 슬리피지

---

## 10. 백테스트

### 10.1 백테스트 목록

**경로**: `/trading/backtests`

실행된 백테스트 결과 목록을 조회합니다.

### 10.2 백테스트 실행

**경로**: `/trading/backtests/run`

1. 테스트할 전략 선택
2. 테스트 기간 설정 (시작일 ~ 종료일)
3. 초기 자본 입력
4. 수수료율 설정 (기본: 0.015%)
5. 슬리피지 설정 (기본: 0%)
6. **"실행"** 클릭

### 10.3 결과 분석 지표

| 지표 | 설명 | 좋은 값 |
|------|------|---------|
| 총 수익률 | 테스트 기간 전체 수익률 | 양수 |
| 연환산 수익률 (CAGR) | 연간 기준 수익률 | > 코스피 수익률 |
| 최대 낙폭 (MDD) | 최대 손실폭 | < 20% |
| 샤프 비율 | 위험 대비 수익률 | > 1.0 |
| 소르티노 비율 | 하방 위험 대비 수익률 | > 1.5 |
| 승률 | 수익 거래 비율 | > 50% |
| 손익비 | 평균 수익/평균 손실 | > 1.5 |
| 총 거래 수 | 백테스트 기간 총 거래 횟수 | - |
| 평균 보유 기간 | 포지션 평균 보유 일수 | - |

### 10.4 거래 내역

백테스트 상세 페이지에서 **"거래 내역"** 탭을 클릭하면 시뮬레이션된 모든 거래를 확인할 수 있습니다:
- 진입/청산 시점
- 진입/청산 가격
- 손익 금액 및 비율
- 보유 기간

### 10.5 차트 분석

- 자산 곡선 (Equity Curve)
- 손익 분포 히스토그램
- 월별 수익률 히트맵
- Drawdown 차트

---

## 11. 고급 분석

### 11.1 포트폴리오 백테스트

**경로**: `/trading/portfolio-backtest`

여러 전략을 조합한 포트폴리오 수준의 백테스트를 실행합니다.

**설정 방법**:
1. 포함할 전략 선택 (복수 선택)
2. 각 전략별 가중치 설정 (합계 100%)
3. 리밸런싱 주기 설정 (일/주/월)
4. **"실행"** 클릭

**분석 결과**:
- 포트폴리오 전체 수익률
- 개별 전략 기여도
- 상관관계 분석
- 분산 효과

### 11.2 Walk-Forward 분석

**경로**: `/trading/walk-forward-analysis`

과적합을 방지하기 위한 Out-of-sample 테스트입니다.

**원리**:
```
|-- 최적화 구간 (In-Sample) --|-- 검증 구간 (Out-of-Sample) --|
|         70%                |           30%               |
```

**설정 방법**:
1. 전략 선택
2. 전체 기간 설정
3. 최적화/검증 비율 설정 (기본: 70/30)
4. Walk 횟수 설정 (기본: 5)
5. **"실행"** 클릭

**분석 결과**:
- In-Sample vs Out-of-Sample 성과 비교
- 과적합 여부 판단
- 안정성 점수

### 11.3 성과 분석

**경로**: `/trading/performance`

실거래 또는 백테스트의 상세 성과를 분석합니다:
- 기간별 수익률 (일/주/월/년)
- 전략별 성과 비교
- 벤치마크 대비 성과
- 주요 지표 대시보드

---

## 12. 전략 최적화

### 12.1 최적화 페이지

**경로**: `/trading/optimization`

### 12.2 파라미터 설정

최적화할 파라미터의 범위를 설정합니다:

```
파라미터: RSI 기간
├── 최소값: 7
├── 최대값: 21
└── 간격: 2
→ 테스트 값: 7, 9, 11, 13, 15, 17, 19, 21

파라미터: 손절률
├── 최소값: 3
├── 최대값: 10
└── 간격: 1
→ 테스트 값: 3, 4, 5, 6, 7, 8, 9, 10
```

### 12.3 최적화 실행

1. 전략 선택
2. 파라미터 범위 설정
3. 테스트 기간 설정
4. 목표 지표 선택:
   - 수익률 최대화
   - 샤프비율 최대화
   - MDD 최소화
5. **"최적화 실행"** 클릭

### 12.4 결과 분석

최적화 결과는 파라미터 조합별 성과를 비교 표시합니다:
- 히트맵: 파라미터 조합별 성과 시각화
- 상위 조합: 목표 지표 기준 상위 N개
- 파라미터 민감도: 각 파라미터의 성과 영향도

### 12.5 과적합 주의사항

> **과적합 경고**: 과거 데이터에 과도하게 최적화하면 실제 거래에서 성과가 저하될 수 있습니다.

**과적합 방지 팁**:
- Walk-Forward 분석 병행
- 충분한 데이터 기간 사용 (최소 2년)
- 파라미터 개수 최소화
- Out-of-Sample 테스트 필수

---

## 13. 리스크 관리

### 13.1 리스크 규칙

**경로**: `/trading/risk-rules`

자동매매 시 적용할 리스크 규칙을 관리합니다.

#### 규칙 유형

| 유형 | 설명 | 예시 |
|------|------|------|
| 일일 손실 한도 | 하루 최대 손실 금액/비율 | 일일 손실 5% 초과 시 중단 |
| 포지션 한도 | 종목당/전체 최대 포지션 | 종목당 최대 10% 비중 |
| 거래 횟수 한도 | 일일 최대 거래 횟수 | 하루 50회 초과 시 중단 |
| 시간대 제한 | 거래 가능 시간대 설정 | 09:00~15:00만 거래 |
| 연속 손실 제한 | 연속 손실 횟수 제한 | 3연속 손실 시 중단 |

### 13.2 리스크 규칙 생성

1. **"새 규칙"** 버튼 클릭
2. 규칙 유형 선택
3. 조건 값 입력
4. 발동 시 액션 선택:
   - 알림만 발송
   - 신규 진입 중단
   - 모든 포지션 청산
   - 킬 스위치 활성화
5. **"저장"** 클릭

### 13.3 킬 스위치

**경로**: `/trading/kill-switch`

> **킬 스위치 활성화 시 모든 자동매매가 즉시 중단됩니다.**

**사용 상황**:
- 시스템 오류 발생 시
- 예상치 못한 시장 상황 (급등락)
- 긴급 상황 대응
- 정기 점검 시

**활성화 방법**:
1. 킬 스위치 페이지 접속
2. **"킬 스위치 활성화"** 버튼 클릭
3. 사유 입력 (선택사항)
4. 확인 대화상자에서 **"확인"**

**범위 설정**:
- **전역 킬 스위치**: 모든 계좌의 자동매매 중단
- **계좌별 킬 스위치**: 특정 계좌만 중단

**비활성화**:
킬 스위치 해제 시 자동매매가 재개됩니다.

### 13.4 VaR 분석

**경로**: `/trading/risk/var`

Value at Risk 계산:

| 지표 | 설명 |
|------|------|
| VaR (95%) | 95% 신뢰수준의 일일 최대 손실 |
| VaR (99%) | 99% 신뢰수준의 일일 최대 손실 |
| CVaR (ES) | Conditional VaR (Expected Shortfall) |

**계산 방법**:
- 히스토리컬 VaR: 과거 수익률 분포 기반
- 파라메트릭 VaR: 정규분포 가정

### 13.5 상관관계 분석

**경로**: `/trading/risk/correlation`

포트폴리오 내 종목간 상관관계 분석:
- 상관관계 매트릭스 히트맵
- 분산 효과 분석
- 집중 위험 식별

---

## 14. 알림 설정

### 14.1 알림 설정

**경로**: `/trading/notifications/settings`

#### 알림 채널

| 채널 | 설명 | 설정 필요 |
|------|------|----------|
| 이메일 | 이메일 알림 | SMTP 설정 |
| SMS | 문자 알림 | SMS API 설정 |
| Telegram | 텔레그램 봇 알림 | Bot Token |
| Slack | 슬랙 채널 알림 | Webhook URL |

#### 알림 이벤트

| 이벤트 | 설명 | 기본값 |
|--------|------|--------|
| 주문 체결 | 주문이 체결되었을 때 | ON |
| 손익 한도 도달 | 설정한 손익 한도에 도달 | ON |
| 전략 활성화/비활성화 | 전략 상태 변경 시 | ON |
| 리스크 규칙 발동 | 리스크 규칙 조건 충족 시 | ON |
| 킬 스위치 활성화 | 킬 스위치 상태 변경 시 | ON |
| 시스템 오류 | API 연결 오류 등 | ON |
| 일일 리포트 | 매일 거래 요약 | OFF |

### 14.2 알림 이력

**경로**: `/trading/notifications/history`

발송된 알림 내역을 조회합니다:
- 발송 시간
- 알림 유형
- 채널
- 내용
- 발송 상태

### 14.3 알림 테스트

**경로**: `/trading/notifications/test`

설정된 채널로 테스트 알림을 발송합니다:
1. 채널 선택
2. **"테스트 발송"** 클릭
3. 수신 확인

---

## 15. 유틸리티

### 15.1 종목 관리

**경로**: `/trading/instruments`

거래 가능한 종목 목록을 조회합니다:

| 항목 | 설명 |
|------|------|
| 종목 코드 | 고유 식별 코드 |
| 종목명 | 종목 이름 |
| 시장 구분 | KOSPI / KOSDAQ / 선물 등 |
| 거래 단위 | 최소 거래 수량 |
| 호가 단위 | 최소 가격 변동 단위 |
| 상태 | 거래 가능 여부 |

### 15.2 헬스 체크

**경로**: `/trading/health-check`

시스템 상태를 확인합니다:

| 항목 | 설명 |
|------|------|
| Trading API 상태 | API 서버 연결 상태 |
| 데이터베이스 상태 | DB 연결 상태 |
| API 응답 시간 | 최근 API 응답 속도 |
| 마지막 동기화 | 마지막 데이터 동기화 시간 |

### 15.3 데모 기능

**경로**: `/trading/demo-scenarios`

실제 거래 없이 시스템 기능을 테스트합니다:
- 데모 백테스트
- 데모 신호 생성
- 데모 최적화

---

## 16. API 연동 가이드

### 16.1 Trading System API 개요

Trading 모듈은 외부 Trading System API (포트 8099)와 연동됩니다.

**API 엔드포인트**:
```
Base URL: http://localhost:8099

Health:     GET  /health
Accounts:   GET  /api/accounts
Strategies: GET  /api/strategies
Orders:     GET  /api/orders
Positions:  GET  /api/positions
```

### 16.2 환경 설정

`.env` 파일에 다음 설정을 추가합니다:

```bash
# Trading System API URL
TRADING_API_BASE_URL=http://localhost:8099

# API 타임아웃 (밀리초)
TRADING_API_TIMEOUT=30000

# API 재시도 횟수
TRADING_API_RETRY_COUNT=3
```

### 16.3 연결 상태 확인

1. `/trading/health-check` 페이지 접속
2. "Trading API" 상태 확인
3. 또는 직접 호출: `curl http://localhost:8099/health`

### 16.4 API 오류 대응

| 오류 코드 | 의미 | 대응 방법 |
|----------|------|----------|
| 연결 거부 | API 서버 미실행 | Trading System API 시작 |
| 타임아웃 | 응답 지연 | 서버 상태 확인, 재시도 |
| 401 | 인증 실패 | API 키 확인 |
| 403 | 권한 없음 | 계정 권한 확인 |
| 500 | 서버 오류 | API 서버 로그 확인 |

### 16.5 동기화 흐름

```
[Maruweb]                    [Trading System API]
    │                               │
    │  1. 전략 정보 전송             │
    │  POST /api/strategies         │
    │ ───────────────────────────▶ │
    │                               │
    │  2. 외부 전략 ID 반환          │
    │ ◀─────────────────────────── │
    │                               │
    │  3. 전략 활성화 요청           │
    │  POST /api/strategies/{id}/activate
    │ ───────────────────────────▶ │
    │                               │
    │  4. 활성화 완료               │
    │ ◀─────────────────────────── │
```

---

## 17. FAQ 및 문제 해결

### 17.1 자주 묻는 질문

**Q: Trading API 연결이 안 됩니다.**
> A: Trading System API가 실행 중인지 확인하세요. `ps aux | grep trading` 또는 해당 서버 로그를 확인합니다.

**Q: 전략 동기화가 실패합니다.**
> A: 필수 필드(계좌, 종목, 진입조건)가 모두 설정되어 있는지 확인하세요. 서버 로그에서 상세 오류를 확인합니다.

**Q: 자동매매가 시작되지 않습니다.**
> A: 1) 킬 스위치가 비활성화 상태인지 확인 2) 전략이 ACTIVE 상태인지 확인 3) 계좌가 활성화 상태인지 확인

**Q: 백테스트 실행이 느립니다.**
> A: 테스트 기간이 너무 길거나 파라미터 조합이 많을 수 있습니다. 기간을 줄이거나 파라미터 범위를 좁혀보세요.

**Q: 포지션 손익이 실시간으로 업데이트되지 않습니다.**
> A: 현재가 조회 API 상태를 확인하세요. 페이지 새로고침 또는 자동 갱신 설정을 확인합니다.

### 17.2 문제 해결 체크리스트

**Trading API 연결 실패**
```
[ ] Trading System API 실행 상태 확인
[ ] .env 파일의 TRADING_API_BASE_URL 확인
[ ] 방화벽/네트워크 설정 확인
[ ] curl로 직접 API 호출 테스트
```

**전략 동기화 실패**
```
[ ] Trading API 연결 상태 확인
[ ] 전략 필수 필드 입력 확인
    - 대상 계좌
    - 종목 코드
    - 진입/청산 조건
[ ] 서버 로그 확인 (tail -f /tmp/maruweb.log)
```

**자동매매 활성화 실패**
```
[ ] 전략 동기화 상태 확인 (syncStatus: SYNCED)
[ ] 킬 스위치 상태 확인 (비활성화)
[ ] 계좌 상태 확인 (ACTIVE)
[ ] 리스크 규칙 충돌 확인
```

**페이지 로드 오류 (500)**
```
[ ] 서버 로그 확인
[ ] 데이터베이스 연결 확인
[ ] 서버 재시작
    ./stop-maruweb.sh && ./run-maruweb.sh
```

### 17.3 로그 확인 방법

```bash
# 서버 로그 실시간 모니터링
tail -f /tmp/maruweb.log

# 최근 100줄 확인
tail -100 /tmp/maruweb.log

# 오류 로그만 필터링
grep ERROR /tmp/maruweb.log

# 특정 시간대 로그 확인
grep "2026-01-13 14:" /tmp/maruweb.log
```

### 17.4 지원 요청 시 포함할 정보

문제 발생 시 다음 정보를 포함하여 지원 요청:
1. 발생한 오류 메시지
2. 오류 발생 URL
3. 수행한 작업 단계
4. 서버 로그 (관련 부분)
5. 브라우저 콘솔 오류 (F12 → Console)

---

## 18. 부록

### 18.1 단축키

| 단축키 | 기능 |
|--------|------|
| `Ctrl + S` | 폼 저장 |
| `Esc` | 모달 닫기 |
| `F5` | 새로고침 |
| `Ctrl + F` | 페이지 내 검색 |

### 18.2 URL 빠른 참조

| 기능 | URL |
|------|-----|
| 대시보드 | `/trading` |
| 계좌 목록 | `/trading/accounts` |
| 잔고 조회 | `/trading/balances` |
| 주문 목록 | `/trading/orders` |
| 체결 내역 | `/trading/fills` |
| 실행 이력 | `/trading/execution-history` |
| 포지션 목록 | `/trading/positions` |
| 전략 목록 | `/trading/strategies` |
| 자동매매 설정 | `/trading/strategies/{id}/trading` |
| 백테스트 목록 | `/trading/backtests` |
| 백테스트 실행 | `/trading/backtests/run` |
| 포트폴리오 백테스트 | `/trading/portfolio-backtest` |
| Walk-Forward 분석 | `/trading/walk-forward-analysis` |
| 전략 최적화 | `/trading/optimization` |
| 성과 분석 | `/trading/performance` |
| 리스크 규칙 | `/trading/risk-rules` |
| 킬 스위치 | `/trading/kill-switch` |
| VaR 분석 | `/trading/risk/var` |
| 상관관계 분석 | `/trading/risk/correlation` |
| 알림 설정 | `/trading/notifications/settings` |
| 알림 이력 | `/trading/notifications/history` |
| 종목 관리 | `/trading/instruments` |
| 헬스 체크 | `/trading/health-check` |

### 18.3 용어 사전

| 용어 | 설명 |
|------|------|
| MDD | Maximum Drawdown, 최대 낙폭 |
| CAGR | 연평균 복합 성장률 |
| 샤프 비율 | 위험 대비 초과 수익률 |
| VaR | Value at Risk, 예상 최대 손실 |
| 슬리피지 | 주문가격과 체결가격의 차이 |
| 과적합 | 과거 데이터에 과도하게 최적화된 상태 |
| Walk-Forward | 과적합 방지를 위한 검증 방법 |
| 킬 스위치 | 긴급 자동매매 중단 기능 |

### 18.4 변경 이력

| 버전 | 날짜 | 변경 내용 |
|------|------|----------|
| 1.0 | 2026-01-13 | 초기 버전 |
| 2.0 | 2026-01-13 | 퀵 스타트 가이드 추가, 실행 이력 섹션 추가, 고급 분석(포트폴리오 백테스트, Walk-Forward) 섹션 추가, API 연동 가이드 추가, FAQ 확장, 용어 사전 추가 |
