# MaruWeb 테스트 계획서

**테스트 대상 버전**: 2026-01-01
**테스트 환경**:
- MaruWeb Server: http://localhost:8090
- Trading System API: http://localhost:8099

---

## 📋 사전 준비사항

### 1. 서버 시작 확인
```bash
# MaruWeb 서버 시작
cd /Users/changsupark/projects/maruweb
./run-maruweb.sh

# Trading System API 시작
cd /Users/changsupark/projects/cautostock
./run-with-env.sh

# Health Check
curl http://localhost:8090/trading/dashboard
curl http://localhost:8099/health
```

### 2. 테스트 데이터 준비
- [ ] 테스트 계좌 최소 2개 등록 (ACTIVE, INACTIVE 각 1개)
- [ ] AUTO_TRADING 전략 최소 1개 생성 및 동기화
- [ ] PENDING 상태 주문 최소 1개 존재
- [ ] 종목 코드: 005930 (삼성전자) 사용 권장

---

## 🧪 테스트 시나리오

## Phase 1: 주문 관리 기능 (Order Management)

### TC-01: 주문 취소
**목적**: PENDING 주문을 취소할 수 있는지 확인

**사전조건**:
- PENDING 상태의 주문이 1개 이상 존재
- Trading System API가 정상 동작 중

**테스트 절차**:
1. http://localhost:8090/trading/orders 접속
2. 계좌 선택 (자동 선택된 첫 번째 계좌 확인)
3. PENDING 상태 주문의 "취소" 버튼 클릭
4. 확인 다이얼로그에서 "확인" 클릭

**예상 결과**:
- ✅ "주문이 성공적으로 취소되었습니다" 메시지 표시
- ✅ 주문 상태가 CANCELLED로 변경
- ✅ 취소/수정 버튼이 사라지고 "-" 표시

**오류 케이스**:
- [ ] 이미 체결된 주문 취소 시도 → "Cancellation failed" 메시지
- [ ] 존재하지 않는 주문 취소 시도 → "Order not found" 메시지

---

### TC-02: 주문 수정
**목적**: PENDING 주문의 가격/수량을 수정할 수 있는지 확인

**테스트 절차**:
1. http://localhost:8090/trading/orders 접속
2. PENDING 상태 주문의 "수정" 버튼 클릭
3. 모달에서 새로운 가격 입력 (예: 70000)
4. "수정" 버튼 클릭

**예상 결과**:
- ✅ "주문이 성공적으로 수정되었습니다" 메시지 표시
- ✅ 주문 목록에서 수정된 가격 확인

**오류 케이스**:
- [ ] 가격과 수량 모두 비워두고 수정 → "수정할 가격 또는 수량을 입력하세요" 메시지
- [ ] 잘못된 형식의 가격 입력 → 입력 검증 오류

---

## Phase 2: 리스크 룰 관리 (Risk Rule Management)

### TC-03: 전역 리스크 룰 설정
**목적**: 시스템 전체에 적용되는 리스크 룰을 설정할 수 있는지 확인

**테스트 절차**:
1. http://localhost:8090/trading/risk-rules 접속
2. "전역 룰 설정" 버튼 클릭
3. 다음 값 입력:
   - 종목당 최대 포지션 금액: 10,000,000
   - 최대 열린 주문 수: 10
   - 분당 최대 주문 수: 5
   - 일일 손실 한도: 1,000,000
   - 연속 주문 실패 한도: 3
4. "저장" 버튼 클릭

**예상 결과**:
- ✅ "전역 리스크 룰이 성공적으로 저장되었습니다" 메시지
- ✅ 리스크 룰 목록에서 GLOBAL 범위 룰 확인
- ✅ 입력한 값들이 정확히 표시됨

---

### TC-04: 계좌별 리스크 룰 설정
**목적**: 특정 계좌에 대한 리스크 룰을 설정할 수 있는지 확인

**테스트 절차**:
1. http://localhost:8090/trading/risk-rules 접속
2. 계좌 선택
3. "계좌 룰 설정" 버튼 클릭
4. 전역 룰보다 작은 값 입력 (예: 최대 포지션 5,000,000)
5. "저장" 버튼 클릭

**예상 결과**:
- ✅ "계좌별 리스크 룰이 성공적으로 저장되었습니다" 메시지
- ✅ ACCOUNT 범위 룰이 목록에 추가됨
- ✅ 계좌 ID가 정확히 표시됨

---

### TC-05: 종목별 리스크 룰 설정
**목적**: 특정 계좌의 특정 종목에 대한 리스크 룰을 설정할 수 있는지 확인

**테스트 절차**:
1. http://localhost:8090/trading/risk-rules 접속
2. 계좌 선택
3. "종목 룰 설정" 버튼 클릭
4. 종목 코드 입력: 005930
5. 리스크 룰 값 입력
6. "저장" 버튼 클릭

**예상 결과**:
- ✅ "종목별 리스크 룰이 성공적으로 저장되었습니다" 메시지
- ✅ SYMBOL 범위 룰이 목록에 추가됨
- ✅ 계좌 ID와 종목 코드가 정확히 표시됨

---

### TC-06: 리스크 룰 삭제
**목적**: 설정된 리스크 룰을 삭제할 수 있는지 확인

**테스트 절차**:
1. 리스크 룰 목록에서 임의의 룰 선택
2. "삭제" 버튼 클릭
3. 확인 다이얼로그에서 "확인" 클릭

**예상 결과**:
- ✅ "리스크 룰이 성공적으로 삭제되었습니다" 메시지
- ✅ 목록에서 해당 룰이 제거됨

---

## Phase 3: 데모 신호 주입 (Demo Signal)

### TC-07: 매수 신호 주입
**목적**: 테스트용 매수 신호를 주입할 수 있는지 확인

**테스트 절차**:
1. http://localhost:8090/trading/demo-signal 접속
2. 다음 값 입력:
   - 계좌: 테스트 계좌 선택 (선택사항)
   - 종목 코드: 005930
   - 매매 구분: 매수 (BUY)
   - 목표 타입: 수량 (QTY)
   - 목표 값: 10
   - 신호 유효 시간: 60
3. "신호 주입" 버튼 클릭

**예상 결과**:
- ✅ "데모 신호가 성공적으로 주입되었습니다" 메시지
- ✅ Trading System에서 신호 처리 시작
- ✅ 주문 조회 페이지에서 생성된 주문 확인 가능

---

### TC-08: 매도 신호 주입
**목적**: 테스트용 매도 신호를 주입할 수 있는지 확인

**테스트 절차**:
1. http://localhost:8090/trading/demo-signal 접속
2. 매도 신호 설정 (매매 구분: 매도)
3. "신호 주입" 버튼 클릭

**예상 결과**:
- ✅ 매도 신호가 정상적으로 처리됨
- ✅ 포지션이 있는 경우 매도 주문 생성

**오류 케이스**:
- [ ] 필수 필드 누락 → 입력 검증 오류
- [ ] Trading System API 중단 시 → "데모 신호 주입에 실패했습니다" 메시지

---

## Phase 4: 전략 수동 실행 (Strategy Execute)

### TC-09: 전략 수동 실행
**목적**: 동기화된 전략을 즉시 실행할 수 있는지 확인

**사전조건**:
- AUTO_TRADING 타입 전략이 존재하고 동기화됨 (externalStrategyId 있음)

**테스트 절차**:
1. http://localhost:8090/trading/strategies 접속
2. 전략 선택 후 "Monitor" 버튼 클릭
3. "수동 실행 (Execute Strategy)" 버튼 클릭
4. 모달에서 다음 확인:
   - 종목 코드: 전략에 설정된 값이 기본값으로 표시
   - 계좌 ID: 전략에 설정된 값이 기본값으로 표시
5. 필요시 값 수정 후 "실행" 버튼 클릭

**예상 결과**:
- ✅ "전략이 성공적으로 실행되었습니다" 메시지
- ✅ Trading System에서 전략 실행 로그 확인
- ✅ 조건 충족 시 주문 생성됨

**오류 케이스**:
- [ ] 동기화되지 않은 전략 실행 시도 → "전략이 Trading System에 동기화되지 않았습니다" 메시지
- [ ] 존재하지 않는 전략 → "Strategy not found" 오류

---

## Phase 5: 계좌 상태 업데이트 (Account Status Update)

### TC-10: 계좌 활성화
**목적**: INACTIVE 계좌를 ACTIVE로 변경할 수 있는지 확인

**사전조건**:
- INACTIVE 상태의 계좌가 1개 이상 존재

**테스트 절차**:
1. http://localhost:8090/trading/accounts 접속
2. INACTIVE 계좌 카드에서 "활성화" 버튼 클릭

**예상 결과**:
- ✅ "계좌가 활성화되었습니다" 메시지
- ✅ 계좌 상태 배지가 ACTIVE로 변경
- ✅ "활성화" 버튼이 사라지고 "비활성화" 버튼으로 변경

---

### TC-11: 계좌 비활성화
**목적**: ACTIVE 계좌를 INACTIVE로 변경할 수 있는지 확인

**사전조건**:
- ACTIVE 상태의 계좌가 1개 이상 존재

**테스트 절차**:
1. http://localhost:8090/trading/accounts 접속
2. ACTIVE 계좌 카드에서 "비활성화" 버튼 클릭
3. 확인 다이얼로그에서 "확인" 클릭

**예상 결과**:
- ✅ "계좌가 비활성화되었습니다" 메시지
- ✅ 계좌 상태 배지가 INACTIVE로 변경
- ✅ "비활성화" 버튼이 사라지고 "활성화" 버튼으로 변경

---

## Phase 6: 통합 시나리오 테스트

### TC-12: 전체 트레이딩 플로우
**목적**: 전체 자동매매 플로우가 정상 작동하는지 확인

**테스트 시나리오**:
1. **계좌 준비**
   - 계좌 등록 또는 기존 계좌 활성화
   - 계좌 잔고 확인

2. **리스크 룰 설정**
   - 전역 리스크 룰 설정
   - 계좌별 리스크 룰 설정 (선택)

3. **전략 생성 및 설정**
   - AUTO_TRADING 전략 생성
   - Configure Trading에서 매매 설정
   - Trading System에 동기화
   - 전략 활성화

4. **신호 주입 및 주문 확인**
   - 데모 신호 주입
   - 주문 조회 페이지에서 주문 확인
   - 포지션 관리 페이지에서 포지션 확인

5. **주문 관리**
   - PENDING 주문 수정
   - 필요시 주문 취소

6. **모니터링**
   - 전략 모니터링 페이지에서 실행 현황 확인
   - 체결 내역 확인
   - 잔고 변동 확인

**예상 결과**:
- ✅ 모든 단계가 순차적으로 정상 작동
- ✅ 리스크 룰이 주문 생성 시 적용됨
- ✅ 데이터가 실시간으로 업데이트됨

---

## 🐛 알려진 이슈 및 제한사항

### 현재 제한사항
1. **잔고 정보**: 현금 잔고 및 미실현 손익은 임시 값 (실제 KIS API 연동 필요)
2. **실시간 업데이트**: 자동 새로고침 기능 없음 (수동 새로고침 필요)
3. **Git Push 오류**: HTTP 400 오류로 원격 저장소 푸시 실패 (로컬에만 커밋됨)

### 테스트 시 주의사항
- ⚠️ 데모 신호는 테스트 환경에서만 사용
- ⚠️ 실제 계좌 사용 시 소액으로 테스트
- ⚠️ Trading System API가 중단되면 모든 기능 사용 불가

---

## 📊 테스트 체크리스트

### 기본 기능
- [ ] TC-01: 주문 취소
- [ ] TC-02: 주문 수정
- [ ] TC-03: 전역 리스크 룰 설정
- [ ] TC-04: 계좌별 리스크 룰 설정
- [ ] TC-05: 종목별 리스크 룰 설정
- [ ] TC-06: 리스크 룰 삭제
- [ ] TC-07: 매수 신호 주입
- [ ] TC-08: 매도 신호 주입
- [ ] TC-09: 전략 수동 실행
- [ ] TC-10: 계좌 활성화
- [ ] TC-11: 계좌 비활성화

### 통합 테스트
- [ ] TC-12: 전체 트레이딩 플로우

### UI/UX 확인
- [ ] 모든 페이지 레이아웃 정상
- [ ] 성공/오류 메시지 정상 표시
- [ ] 모달 창 정상 작동
- [ ] 버튼 정렬 및 높이 일관성
- [ ] 자동 계좌 선택 기능 작동

### 오류 처리
- [ ] API 연결 실패 시 적절한 오류 메시지
- [ ] 잘못된 입력값 검증
- [ ] 권한 없는 작업 차단

---

## 📝 테스트 결과 기록

### 테스트 일시: _______________
### 테스터: _______________

| TC | 테스트 항목 | 결과 | 비고 |
|----|-----------|------|------|
| TC-01 | 주문 취소 | ⬜ Pass / ⬜ Fail | |
| TC-02 | 주문 수정 | ⬜ Pass / ⬜ Fail | |
| TC-03 | 전역 리스크 룰 | ⬜ Pass / ⬜ Fail | |
| TC-04 | 계좌 리스크 룰 | ⬜ Pass / ⬜ Fail | |
| TC-05 | 종목 리스크 룰 | ⬜ Pass / ⬜ Fail | |
| TC-06 | 리스크 룰 삭제 | ⬜ Pass / ⬜ Fail | |
| TC-07 | 매수 신호 주입 | ⬜ Pass / ⬜ Fail | |
| TC-08 | 매도 신호 주입 | ⬜ Pass / ⬜ Fail | |
| TC-09 | 전략 수동 실행 | ⬜ Pass / ⬜ Fail | |
| TC-10 | 계좌 활성화 | ⬜ Pass / ⬜ Fail | |
| TC-11 | 계좌 비활성화 | ⬜ Pass / ⬜ Fail | |
| TC-12 | 통합 플로우 | ⬜ Pass / ⬜ Fail | |

### 발견된 버그

#### Bug #1
- **심각도**: ⬜ Critical / ⬜ Major / ⬜ Minor
- **증상**:
- **재현 방법**:
- **예상 동작**:
- **실제 동작**:

---

## 🔄 회귀 테스트

### 기존 기능 확인
- [ ] 계좌 관리 (CRUD)
- [ ] 전략 관리 (CRUD, 동기화, 활성화/비활성화)
- [ ] 주문 조회
- [ ] 포지션 관리
- [ ] 체결 내역 조회
- [ ] 잔고 조회
- [ ] Kill Switch
- [ ] Dashboard

---

## 📞 문제 발생 시 대응

### 서버 재시작
```bash
# MaruWeb 재시작
cd /Users/changsupark/projects/maruweb
./stop-maruweb.sh
./run-maruweb.sh

# Trading System 재시작
cd /Users/changsupark/projects/cautostock
# (기존 프로세스 종료 후)
./run-with-env.sh
```

### 로그 확인
```bash
# MaruWeb 로그
tail -f /tmp/maruweb.log

# Trading System 로그
tail -f /Users/changsupark/cautostock.log
```

### 데이터베이스 확인
```bash
mysql -u $DB_USERNAME -p$DB_PASSWORD maruweb
```
