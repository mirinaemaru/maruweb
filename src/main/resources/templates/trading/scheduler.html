<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/main}">
<head>
    <title>ì „ëµ ìŠ¤ì¼€ì¤„ëŸ¬ ê´€ë¦¬</title>
    <th:block layout:fragment="extra-css">
        <style>
            .scheduler-container {
                max-width: 1200px;
                margin: 0 auto;
                padding: 20px;
                padding-bottom: 40px;
            }

            .page-header {
                margin-bottom: 30px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                padding: 30px 40px;
                border-radius: 16px;
                color: white;
                box-shadow: 0 10px 40px rgba(102, 126, 234, 0.3);
            }
            [data-theme="dark"] .page-header {
                background: linear-gradient(135deg, #2a2d4a 0%, #1e2139 100%);
                box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
                border: 1px solid rgba(255, 255, 255, 0.1);
            }

            .page-header h2 {
                font-size: 28px;
                font-weight: 700;
                margin: 0;
                color: white;
            }

            .page-header p {
                margin: 10px 0 0 0;
                opacity: 0.9;
                font-size: 14px;
            }

            .alert {
                padding: 15px 20px;
                margin-bottom: 20px;
                border-radius: 12px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            }

            .alert-success {
                background: #d4edda;
                color: #155724;
                border: 1px solid #c3e6cb;
            }

            .alert-error {
                background: #f8d7da;
                color: #721c24;
                border: 1px solid #f5c6cb;
            }

            [data-theme="dark"] .alert-success {
                background: rgba(40, 167, 69, 0.2);
                color: #75d99b;
                border-color: rgba(40, 167, 69, 0.3);
            }

            [data-theme="dark"] .alert-error {
                background: rgba(220, 53, 69, 0.2);
                color: #f5a5ae;
                border-color: rgba(220, 53, 69, 0.3);
            }

            .card {
                background: var(--bg-secondary);
                border: none;
                border-radius: 12px;
                box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                transition: all 0.3s ease;
                margin-bottom: 20px;
            }

            .card:hover {
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            }

            .card-header {
                background: var(--bg-tertiary);
                border-bottom: 1px solid var(--border-color);
                padding: 15px 20px;
                border-radius: 12px 12px 0 0;
            }

            .card-header h5 {
                margin: 0;
                font-size: 16px;
                font-weight: 600;
                color: var(--text-primary);
            }

            .card-body {
                color: var(--text-primary);
                padding: 20px;
            }

            .status-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 15px;
            }

            .status-item {
                padding: 15px;
                background: var(--bg-tertiary);
                border-radius: 10px;
                transition: background-color 0.3s ease;
            }

            .status-label {
                font-size: 13px;
                color: var(--text-secondary);
                margin-bottom: 5px;
                font-weight: 500;
            }

            .status-value {
                font-size: 16px;
                font-weight: 600;
                color: var(--text-primary);
            }

            .status-value.active {
                color: #28a745;
            }

            .status-value.inactive {
                color: #dc3545;
            }

            .stats-box {
                background: var(--bg-tertiary);
                padding: 15px 20px;
                border-radius: 10px;
                margin-top: 15px;
            }

            .stats-title {
                font-weight: 600;
                color: var(--text-primary);
                margin-bottom: 10px;
                font-size: 14px;
            }

            .stats-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 10px;
            }

            .stat-item {
                text-align: center;
            }

            .stat-value {
                font-size: 20px;
                font-weight: 700;
                color: var(--text-primary);
            }

            .stat-label {
                font-size: 12px;
                color: var(--text-secondary);
            }

            .stat-value.success {
                color: #28a745;
            }

            .stat-value.failed {
                color: #dc3545;
            }

            .form-group {
                margin-bottom: 15px;
            }

            .form-label {
                display: block;
                font-weight: 600;
                color: var(--text-primary);
                font-size: 14px;
                margin-bottom: 8px;
            }

            .form-control {
                width: 100%;
                padding: 12px 15px;
                border: 2px solid var(--border-color);
                border-radius: 8px;
                font-size: 14px;
                background: var(--bg-tertiary);
                color: var(--text-primary);
                transition: all 0.3s ease;
                box-sizing: border-box;
            }

            .form-control:focus {
                outline: none;
                border-color: #667eea;
                box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            }

            .btn {
                padding: 12px 24px;
                border: none;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s;
                text-decoration: none;
                display: inline-flex;
                align-items: center;
                gap: 8px;
            }

            .btn-primary {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            }

            .btn-primary:hover {
                transform: translateY(-2px);
                box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
            }

            .btn-success {
                background: linear-gradient(135deg, #28a745 0%, #218838 100%);
                color: white;
                box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
            }

            .btn-success:hover {
                transform: translateY(-2px);
                box-shadow: 0 8px 25px rgba(40, 167, 69, 0.4);
            }

            .btn-danger {
                background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
                color: white;
                box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);
            }

            .btn-danger:hover {
                transform: translateY(-2px);
                box-shadow: 0 8px 25px rgba(220, 53, 69, 0.4);
            }

            .btn-warning {
                background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%);
                color: #212529;
                box-shadow: 0 4px 15px rgba(255, 193, 7, 0.3);
            }

            .btn-warning:hover {
                transform: translateY(-2px);
                box-shadow: 0 8px 25px rgba(255, 193, 7, 0.4);
            }

            .btn-secondary {
                background: linear-gradient(135deg, #6c757d 0%, #545b62 100%);
                color: white;
                box-shadow: 0 4px 15px rgba(108, 117, 125, 0.3);
            }

            .btn-secondary:hover {
                transform: translateY(-2px);
                box-shadow: 0 8px 25px rgba(108, 117, 125, 0.4);
            }

            [data-theme="dark"] .btn-primary,
            [data-theme="dark"] .btn-success,
            [data-theme="dark"] .btn-danger,
            [data-theme="dark"] .btn-warning,
            [data-theme="dark"] .btn-secondary {
                background: #4a5568;
                box-shadow: 0 4px 15px rgba(74, 85, 104, 0.3);
                color: white;
            }

            [data-theme="dark"] .btn-primary:hover,
            [data-theme="dark"] .btn-success:hover,
            [data-theme="dark"] .btn-danger:hover,
            [data-theme="dark"] .btn-warning:hover,
            [data-theme="dark"] .btn-secondary:hover {
                background: #5a6778;
            }

            .action-cards {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
                gap: 20px;
            }

            .info-box {
                background: var(--bg-secondary);
                padding: 20px;
                border-radius: 12px;
                border-left: 4px solid #667eea;
                margin-top: 20px;
                transition: background-color 0.3s ease;
            }

            [data-theme="dark"] .info-box {
                border-left-color: #8b9df0;
            }

            .info-box h3 {
                margin-top: 0;
                color: #667eea;
                font-size: 16px;
            }

            [data-theme="dark"] .info-box h3 {
                color: #8b9df0;
            }

            .info-box p {
                margin: 8px 0;
                color: var(--text-primary);
                font-size: 14px;
                line-height: 1.6;
            }

            .info-box ul {
                margin: 8px 0;
                padding-left: 20px;
                color: var(--text-primary);
                font-size: 14px;
                line-height: 1.8;
            }
        </style>
    </th:block>
</head>
<body>
<div layout:fragment="content">
    <div class="scheduler-container">
        <!-- í˜ì´ì§€ í—¤ë” -->
        <div class="page-header">
            <h2>â° ì „ëµ ìŠ¤ì¼€ì¤„ëŸ¬ ê´€ë¦¬</h2>
            <p>ì „ëµ ì‹¤í–‰ ìŠ¤ì¼€ì¤„ëŸ¬ë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤</p>
        </div>

        <!-- ì—ëŸ¬ ë©”ì‹œì§€ -->
        <div th:if="${error}" class="alert alert-error" th:text="${error}"></div>

        <!-- ì„±ê³µ ë©”ì‹œì§€ -->
        <div th:if="${message}" class="alert alert-success" th:text="${message}"></div>

        <!-- ìŠ¤ì¼€ì¤„ëŸ¬ ìƒíƒœ ì¹´ë“œ -->
        <div class="card" th:if="${status}">
            <div class="card-header">
                <h5>ğŸ“Š ìŠ¤ì¼€ì¤„ëŸ¬ ìƒíƒœ</h5>
            </div>
            <div class="card-body">
                <div class="status-grid">
                    <div class="status-item">
                        <div class="status-label">ìƒíƒœ</div>
                        <div class="status-value" th:classappend="${status.enabled ? 'active' : 'inactive'}"
                             th:text="${status.enabled ? 'âœ… í™œì„±' : 'âŒ ë¹„í™œì„±'}">í™œì„±</div>
                    </div>
                    <div class="status-item">
                        <div class="status-label">ì‹¤í–‰ ìƒíƒœ</div>
                        <div class="status-value" th:text="${status.status != null ? status.status : 'N/A'}">RUNNING</div>
                    </div>
                    <div class="status-item">
                        <div class="status-label">í™œì„± ì „ëµ ìˆ˜</div>
                        <div class="status-value" th:text="${status.activeStrategiesCount} + 'ê°œ'">0ê°œ</div>
                    </div>
                    <div class="status-item">
                        <div class="status-label">ë§ˆì§€ë§‰ ì‹¤í–‰</div>
                        <div class="status-value" th:text="${status.lastExecutionTime != null ? status.lastExecutionTime : '-'}">-</div>
                    </div>
                    <div class="status-item">
                        <div class="status-label">ë‹¤ìŒ ì‹¤í–‰</div>
                        <div class="status-value" th:text="${status.nextExecutionTime != null ? status.nextExecutionTime : '-'}">-</div>
                    </div>
                </div>

                <!-- ì‹¤í–‰ í†µê³„ -->
                <div class="stats-box" th:if="${status.executionStats != null}">
                    <div class="stats-title">ğŸ“ˆ ì‹¤í–‰ í†µê³„</div>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value" th:text="${status.executionStats.totalExecutions}">0</div>
                            <div class="stat-label">ì´ ì‹¤í–‰</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value success" th:text="${status.executionStats.successfulExecutions}">0</div>
                            <div class="stat-label">ì„±ê³µ</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value failed" th:text="${status.executionStats.failedExecutions}">0</div>
                            <div class="stat-label">ì‹¤íŒ¨</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" th:text="${#numbers.formatDecimal(status.executionStats.successRate, 1, 1)} + '%'">0.0%</div>
                            <div class="stat-label">ì„±ê³µë¥ </div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" th:text="${status.executionStats.avgExecutionTimeMs} + 'ms'">0ms</div>
                            <div class="stat-label">í‰ê·  ì‹¤í–‰ì‹œê°„</div>
                        </div>
                    </div>
                </div>

                <!-- ë©”ì‹œì§€ -->
                <div th:if="${status.message}" class="stats-box" style="margin-top: 15px; border-left: 3px solid #ffc107;">
                    <div class="status-label">ë©”ì‹œì§€</div>
                    <div class="status-value" th:text="${status.message}">-</div>
                </div>
            </div>
        </div>

        <!-- ì•¡ì…˜ ì¹´ë“œë“¤ -->
        <div class="action-cards">
            <!-- ìŠ¤ì¼€ì¤„ëŸ¬ ì œì–´ -->
            <div class="card">
                <div class="card-header">
                    <h5>ğŸ”Œ ìŠ¤ì¼€ì¤„ëŸ¬ ì œì–´</h5>
                </div>
                <div class="card-body">
                    <p style="margin-bottom: 15px; color: var(--text-secondary);">ìŠ¤ì¼€ì¤„ëŸ¬ë¥¼ í™œì„±í™”í•˜ê±°ë‚˜ ë¹„í™œì„±í™”í•©ë‹ˆë‹¤.</p>
                    <div th:if="${status != null && !status.enabled}">
                        <form th:action="@{/trading/scheduler/enable}" method="post">
                            <button type="submit" class="btn btn-success">
                                <span>â–¶ï¸</span> ìŠ¤ì¼€ì¤„ëŸ¬ í™œì„±í™”
                            </button>
                        </form>
                    </div>
                    <div th:if="${status != null && status.enabled}">
                        <form th:action="@{/trading/scheduler/disable}" method="post">
                            <button type="submit" class="btn btn-danger">
                                <span>â¹ï¸</span> ìŠ¤ì¼€ì¤„ëŸ¬ ë¹„í™œì„±í™”
                            </button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- ì „ëµ ì‹¤í–‰ -->
            <div class="card">
                <div class="card-header">
                    <h5>â–¶ï¸ ì „ëµ ì‹¤í–‰</h5>
                </div>
                <div class="card-body">
                    <form th:action="@{/trading/scheduler/trigger}" method="post">
                        <div class="form-group">
                            <label for="strategyId" class="form-label">ì „ëµ ì„ íƒ</label>
                            <select class="form-control" id="strategyId" name="strategyId" required>
                                <option value="">-- ì „ëµì„ ì„ íƒí•˜ì„¸ìš” --</option>
                                <th:block th:each="strategy : ${strategies}">
                                    <option th:value="${strategy['id']}" th:text="${strategy['name'] != null ? strategy['name'] : strategy['id']}">ì „ëµëª…</option>
                                </th:block>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary">
                            <span>â–¶ï¸</span> ì‹¤í–‰
                        </button>
                    </form>
                </div>
            </div>

            <!-- ì „ì²´ ì‹¤í–‰ -->
            <div class="card">
                <div class="card-header">
                    <h5>âš¡ ì „ì²´ ì‹¤í–‰</h5>
                </div>
                <div class="card-body">
                    <p style="margin-bottom: 15px; color: var(--text-secondary);">ëª¨ë“  í™œì„± ì „ëµì„ ì¦‰ì‹œ ì‹¤í–‰í•©ë‹ˆë‹¤.</p>
                    <form th:action="@{/trading/scheduler/execute-all}" method="post">
                        <button type="submit" class="btn btn-warning">
                            <span>âš¡</span> ì „ì²´ ì‹¤í–‰
                        </button>
                    </form>
                </div>
            </div>

            <!-- í†µê³„ ì´ˆê¸°í™” -->
            <div class="card">
                <div class="card-header">
                    <h5>ğŸ”„ í†µê³„ ì´ˆê¸°í™”</h5>
                </div>
                <div class="card-body">
                    <p style="margin-bottom: 15px; color: var(--text-secondary);">ì‹¤í–‰ í†µê³„ë¥¼ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.</p>
                    <form th:action="@{/trading/scheduler/reset-stats}" method="post" onsubmit="return confirm('ì •ë§ë¡œ í†µê³„ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
                        <button type="submit" class="btn btn-secondary">
                            <span>ğŸ”„</span> í†µê³„ ì´ˆê¸°í™”
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Info Box -->
        <div class="info-box">
            <h3>â„¹ï¸ ìŠ¤ì¼€ì¤„ëŸ¬ ì•ˆë‚´</h3>
            <ul>
                <li><strong>í™œì„±í™”/ë¹„í™œì„±í™”:</strong> ìë™ ì „ëµ ì‹¤í–‰ì„ ì œì–´í•©ë‹ˆë‹¤.</li>
                <li><strong>ì „ëµ ì‹¤í–‰:</strong> íŠ¹ì • ì „ëµì„ ìˆ˜ë™ìœ¼ë¡œ ì¦‰ì‹œ ì‹¤í–‰í•©ë‹ˆë‹¤.</li>
                <li><strong>ì „ì²´ ì‹¤í–‰:</strong> ëª¨ë“  í™œì„± ì „ëµì„ ì¦‰ì‹œ ì‹¤í–‰í•©ë‹ˆë‹¤.</li>
                <li><strong>í†µê³„ ì´ˆê¸°í™”:</strong> ì‹¤í–‰ ê¸°ë¡ê³¼ í†µê³„ë¥¼ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.</li>
            </ul>
        </div>
    </div>
</div>
</body>
</html>
