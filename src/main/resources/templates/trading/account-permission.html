<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/main}">
<head>
    <title>ê³„ì¢Œ ê¶Œí•œ ê´€ë¦¬</title>
    <th:block layout:fragment="extra-css">
        <style>
            .form-page {
                padding: 30px;
                max-width: 900px;
                margin: 0 auto;
            }
            .page-header {
                margin-bottom: 40px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                padding: 40px;
                border-radius: 16px;
                color: white;
                box-shadow: 0 10px 40px rgba(102, 126, 234, 0.3);
            }
            [data-theme="dark"] .page-header {
                background: linear-gradient(135deg, #2a2d4a 0%, #1e2139 100%);
                box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
                border: 1px solid rgba(255, 255, 255, 0.1);
            }
            .page-header h1 {
                font-size: 36px;
                font-weight: 700;
                margin-bottom: 10px;
                display: flex;
                align-items: center;
                gap: 15px;
            }
            .page-header p {
                font-size: 16px;
                opacity: 0.95;
                margin: 0;
            }

            .account-info-card {
                background: var(--bg-secondary);
                border-radius: 16px;
                padding: 30px;
                margin-bottom: 30px;
                box-shadow: 0 4px 20px rgba(0,0,0,0.08);
                border: 1px solid rgba(0,0,0,0.04);
            }
            .account-info-title {
                font-size: 18px;
                font-weight: 700;
                color: var(--text-primary);
                margin-bottom: 20px;
                padding-bottom: 15px;
                border-bottom: 2px solid var(--border-color);
            }
            .account-info-row {
                display: flex;
                padding: 12px 0;
                border-bottom: 1px solid var(--border-color);
            }
            .account-info-row:last-child {
                border-bottom: none;
            }
            .account-info-label {
                font-weight: 600;
                color: var(--text-secondary);
                min-width: 150px;
            }
            .account-info-value {
                color: var(--text-primary);
                flex: 1;
            }

            .form-container {
                background: var(--bg-secondary);
                border-radius: 16px;
                padding: 40px;
                box-shadow: 0 4px 20px rgba(0,0,0,0.08);
                border: 1px solid rgba(0,0,0,0.04);
            }
            .form-section-title {
                font-size: 20px;
                font-weight: 700;
                color: var(--text-primary);
                margin-bottom: 25px;
                padding-bottom: 15px;
                border-bottom: 2px solid var(--border-color);
            }
            .permission-group {
                margin-bottom: 30px;
            }
            .permission-category {
                font-size: 16px;
                font-weight: 600;
                color: var(--text-primary);
                margin-bottom: 15px;
                display: flex;
                align-items: center;
                gap: 10px;
            }
            .permission-items {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 20px;
                padding-left: 10px;
            }
            .permission-item {
                display: flex;
                align-items: flex-start;
                gap: 12px;
                padding: 18px;
                background: var(--bg-primary);
                border-radius: 12px;
                border: 2px solid var(--border-color);
                transition: all 0.3s;
                cursor: pointer;
            }
            .permission-item:hover {
                border-color: #667eea;
                background: var(--bg-tertiary);
            }
            .permission-item input[type="checkbox"] {
                width: 22px;
                height: 22px;
                cursor: pointer;
                margin-top: 2px;
                flex-shrink: 0;
            }
            .permission-content {
                flex: 1;
            }
            .permission-label {
                font-weight: 600;
                color: var(--text-primary);
                font-size: 15px;
                margin-bottom: 5px;
                display: block;
                cursor: pointer;
            }
            .permission-description {
                font-size: 13px;
                color: var(--text-muted);
                line-height: 1.5;
            }
            .permission-item.checked {
                border-color: #667eea;
                background: rgba(102, 126, 234, 0.08);
            }
            [data-theme="dark"] .permission-item.checked {
                background: rgba(102, 126, 234, 0.15);
            }

            .form-actions {
                display: flex;
                gap: 15px;
                margin-top: 35px;
                padding-top: 25px;
                border-top: 2px solid var(--border-color);
            }
            .btn {
                padding: 14px 32px;
                border: none;
                border-radius: 10px;
                font-size: 15px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                text-decoration: none;
                display: inline-block;
            }
            .btn-primary {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            }
            .btn-primary:hover {
                transform: translateY(-3px);
                box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
            }
            [data-theme="dark"] .btn-primary {
                background: var(--bg-tertiary);
                color: var(--text-primary);
            }
            [data-theme="dark"] .btn-primary:hover {
                background: #4a5568;
            }
            .btn-secondary {
                background: #e8e8e8;
                color: var(--text-secondary);
            }
            .btn-secondary:hover {
                background: #d0d0d0;
            }
            [data-theme="dark"] .btn-secondary {
                background: var(--bg-tertiary);
                color: var(--text-primary);
            }
            [data-theme="dark"] .btn-secondary:hover {
                background: #4a5568;
            }

            .alert {
                padding: 14px 20px;
                border-radius: 10px;
                margin-bottom: 25px;
                font-weight: 500;
                display: flex;
                align-items: center;
                gap: 10px;
            }
            .alert-success {
                background-color: #d4edda;
                color: #155724;
                border: 1px solid #c3e6cb;
            }
            .alert-error {
                background-color: #f8d7da;
                color: #721c24;
                border: 1px solid #f5c6cb;
            }
            [data-theme="dark"] .alert-success {
                background-color: rgba(40, 167, 69, 0.2);
                color: #a8e6af;
                border-color: rgba(40, 167, 69, 0.4);
            }
            [data-theme="dark"] .alert-error {
                background-color: rgba(220, 53, 69, 0.2);
                color: #f8b4b4;
                border-color: rgba(220, 53, 69, 0.4);
            }

            .warning-box {
                background: #fff3cd;
                border: 2px solid #ffc107;
                border-radius: 12px;
                padding: 20px;
                margin-bottom: 30px;
                display: flex;
                align-items: flex-start;
                gap: 12px;
            }
            [data-theme="dark"] .warning-box {
                background: rgba(255, 193, 7, 0.15);
                border-color: rgba(255, 193, 7, 0.4);
            }
            .warning-icon {
                font-size: 24px;
                flex-shrink: 0;
            }
            .warning-content {
                flex: 1;
            }
            .warning-title {
                font-weight: 700;
                color: #856404;
                margin-bottom: 8px;
            }
            [data-theme="dark"] .warning-title {
                color: #ffc107;
            }
            .warning-text {
                color: #856404;
                font-size: 14px;
                line-height: 1.6;
            }
            [data-theme="dark"] .warning-text {
                color: #ffd966;
            }
        </style>
    </th:block>
</head>
<body>
    <div layout:fragment="content">
        <div class="form-page">
            <div class="page-header">
                <h1>ğŸ” ê³„ì¢Œ ê¶Œí•œ ê´€ë¦¬</h1>
                <p>ê³„ì¢Œì˜ ê±°ë˜ ê¶Œí•œì„ ì„¤ì •í•©ë‹ˆë‹¤.</p>
            </div>

            <div th:if="${message}" class="alert alert-success">
                <span>âœ“</span>
                <span th:text="${message}">ì„±ê³µ ë©”ì‹œì§€</span>
            </div>

            <div th:if="${error}" class="alert alert-error">
                <span>âœ—</span>
                <span th:text="${error}">ì˜¤ë¥˜ ë©”ì‹œì§€</span>
            </div>

            <!-- ê³„ì¢Œ ì •ë³´ ì¹´ë“œ -->
            <div class="account-info-card">
                <div class="account-info-title">ğŸ“‹ ê³„ì¢Œ ì •ë³´</div>
                <div class="account-info-row">
                    <div class="account-info-label">ê³„ì¢Œ ID</div>
                    <div class="account-info-value" th:text="${account?.accountId}">-</div>
                </div>
                <div class="account-info-row">
                    <div class="account-info-label">ê³„ì¢Œ ë³„ì¹­</div>
                    <div class="account-info-value" th:text="${account?.alias}">-</div>
                </div>
                <div class="account-info-row">
                    <div class="account-info-label">ì¦ê¶Œì‚¬</div>
                    <div class="account-info-value" th:text="${account?.broker}">-</div>
                </div>
                <div class="account-info-row">
                    <div class="account-info-label">ê³„ì¢Œë²ˆí˜¸</div>
                    <div class="account-info-value" th:text="${account?.cano + '-' + account?.acntPrdtCd}">-</div>
                </div>
                <div class="account-info-row">
                    <div class="account-info-label">ê³„ì¢Œ íƒ€ì…</div>
                    <div class="account-info-value">
                        <span th:if="${account?.environment == 'PAPER'}" style="color: #667eea; font-weight: 600;">ğŸ“ PAPER (ëª¨ì˜íˆ¬ì)</span>
                        <span th:if="${account?.environment == 'LIVE'}" style="color: #dc3545; font-weight: 600;">ğŸ’° LIVE (ì‹¤ì „íˆ¬ì)</span>
                    </div>
                </div>
            </div>

            <!-- ê²½ê³  ë©”ì‹œì§€ -->
            <div class="warning-box" th:if="${account?.environment == 'LIVE'}">
                <div class="warning-icon">âš ï¸</div>
                <div class="warning-content">
                    <div class="warning-title">ì‹¤ì „íˆ¬ì ê³„ì¢Œ ê¶Œí•œ ì„¤ì •</div>
                    <div class="warning-text">
                        ì´ ê³„ì¢ŒëŠ” ì‹¤ì œ ìê¸ˆìœ¼ë¡œ ê±°ë˜ë©ë‹ˆë‹¤. ê¶Œí•œ ì„¤ì • ì‹œ ì‹ ì¤‘í•˜ê²Œ í™•ì¸í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.
                        íŠ¹íˆ ìë™ë§¤ë§¤(Auto Trade) ê¶Œí•œì€ ì‹œìŠ¤í…œì´ ìë™ìœ¼ë¡œ ë§¤ë§¤ë¥¼ ì‹¤í–‰í•˜ë¯€ë¡œ ì£¼ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.
                    </div>
                </div>
            </div>

            <!-- ê¶Œí•œ ì„¤ì • í¼ -->
            <div class="form-container">
                <form th:action="@{/trading/accounts/{accountId}/permissions(accountId=${accountId})}"
                      method="post"
                      id="permissionForm">

                    <div class="form-section-title">ê¶Œí•œ ì„¤ì •</div>

                    <!-- ê±°ë˜ ê¶Œí•œ -->
                    <div class="permission-group">
                        <div class="permission-category">
                            ğŸ’¼ ê±°ë˜ ê¶Œí•œ
                        </div>
                        <div class="permission-items">
                            <label class="permission-item" th:classappend="${permission?.tradeBuy == true ? 'checked' : ''}">
                                <input type="checkbox"
                                       name="tradeBuy"
                                       th:checked="${permission?.tradeBuy == true}"
                                       onchange="updateItemStyle(this)">
                                <div class="permission-content">
                                    <span class="permission-label">ë§¤ìˆ˜ ê¶Œí•œ (Trade Buy)</span>
                                    <div class="permission-description">
                                        ì£¼ì‹ì„ ë§¤ìˆ˜í•  ìˆ˜ ìˆëŠ” ê¶Œí•œì…ë‹ˆë‹¤.
                                    </div>
                                </div>
                            </label>

                            <label class="permission-item" th:classappend="${permission?.tradeSell == true ? 'checked' : ''}">
                                <input type="checkbox"
                                       name="tradeSell"
                                       th:checked="${permission?.tradeSell == true}"
                                       onchange="updateItemStyle(this)">
                                <div class="permission-content">
                                    <span class="permission-label">ë§¤ë„ ê¶Œí•œ (Trade Sell)</span>
                                    <div class="permission-description">
                                        ì£¼ì‹ì„ ë§¤ë„í•  ìˆ˜ ìˆëŠ” ê¶Œí•œì…ë‹ˆë‹¤.
                                    </div>
                                </div>
                            </label>
                        </div>
                    </div>

                    <!-- ë§¤ë§¤ ë°©ì‹ ê¶Œí•œ -->
                    <div class="permission-group">
                        <div class="permission-category">
                            ğŸ¯ ë§¤ë§¤ ë°©ì‹ ê¶Œí•œ
                        </div>
                        <div class="permission-items">
                            <label class="permission-item" th:classappend="${permission?.autoTrade == true ? 'checked' : ''}">
                                <input type="checkbox"
                                       name="autoTrade"
                                       th:checked="${permission?.autoTrade == true}"
                                       onchange="updateItemStyle(this)">
                                <div class="permission-content">
                                    <span class="permission-label">ìë™ë§¤ë§¤ ê¶Œí•œ (Auto Trade)</span>
                                    <div class="permission-description">
                                        ì‹œìŠ¤í…œì´ ìë™ìœ¼ë¡œ ë§¤ë§¤ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ê¶Œí•œì…ë‹ˆë‹¤.
                                    </div>
                                </div>
                            </label>

                            <label class="permission-item" th:classappend="${permission?.manualTrade == true ? 'checked' : ''}">
                                <input type="checkbox"
                                       name="manualTrade"
                                       th:checked="${permission?.manualTrade == true}"
                                       onchange="updateItemStyle(this)">
                                <div class="permission-content">
                                    <span class="permission-label">ìˆ˜ë™ë§¤ë§¤ ê¶Œí•œ (Manual Trade)</span>
                                    <div class="permission-description">
                                        ì‚¬ìš©ìê°€ ì§ì ‘ ë§¤ë§¤ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ê¶Œí•œì…ë‹ˆë‹¤.
                                    </div>
                                </div>
                            </label>
                        </div>
                    </div>

                    <!-- ê³„ì¢Œ íƒ€ì… ì„¤ì • -->
                    <div class="permission-group">
                        <div class="permission-category">
                            ğŸ¦ ê³„ì¢Œ íƒ€ì… ì„¤ì •
                        </div>
                        <div class="permission-items">
                            <label class="permission-item" th:classappend="${permission?.paperOnly == true ? 'checked' : ''}">
                                <input type="checkbox"
                                       name="paperOnly"
                                       th:checked="${permission?.paperOnly == true}"
                                       onchange="updateItemStyle(this)">
                                <div class="permission-content">
                                    <span class="permission-label">ëª¨ì˜íˆ¬ì ì „ìš© (Paper Only)</span>
                                    <div class="permission-description">
                                        ì²´í¬ ì‹œ ëª¨ì˜íˆ¬ìë§Œ ê°€ëŠ¥í•˜ë©°, ì²´í¬ í•´ì œ ì‹œ ì‹¤ì „íˆ¬ìê°€ í™œì„±í™”ë©ë‹ˆë‹¤.
                                    </div>
                                </div>
                            </label>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">ğŸ’¾ ê¶Œí•œ ì €ì¥</button>
                        <a th:href="@{/trading/accounts/{id}(id=${accountId})}" class="btn btn-secondary">â† ê³„ì¢Œ ìƒì„¸ë¡œ</a>
                        <a th:href="@{/trading/accounts}" class="btn btn-secondary">ê³„ì¢Œ ëª©ë¡</a>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <th:block layout:fragment="extra-js">
        <script>
            // ì²´í¬ë°•ìŠ¤ ë³€ê²½ ì‹œ permission-item ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
            function updateItemStyle(checkbox) {
                const item = checkbox.closest('.permission-item');
                if (checkbox.checked) {
                    item.classList.add('checked');
                } else {
                    item.classList.remove('checked');
                }
            }

            // í¼ ì œì¶œ í™•ì¸
            document.getElementById('permissionForm').addEventListener('submit', function(e) {
                const isLive = /*[[${account?.environment == 'LIVE'}]]*/ false;
                const paperOnly = document.querySelector('input[name="paperOnly"]').checked;

                if (isLive && !paperOnly) {
                    if (!confirm('âš ï¸ ì‹¤ì „íˆ¬ì ê³„ì¢Œì˜ ê¶Œí•œì„ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ì‹¤ì œ ê±°ë˜ì— ì˜í–¥ì„ ë¯¸ì¹  ìˆ˜ ìˆìŠµë‹ˆë‹¤.')) {
                        e.preventDefault();
                    }
                }
            });
        </script>
    </th:block>
</body>
</html>
