<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/main}">
<head>
    <title>ìƒê´€ê´€ê³„ ë¶„ì„</title>
    <style>
        .correlation-container {
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .correlation-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 20px;
        }
            [data-theme="dark"] .correlation-header {
                background: linear-gradient(135deg, #2a2d4a 0%, #1e2139 100%);
                box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
                border: 1px solid rgba(255, 255, 255, 0.1);
            }

        .correlation-header h1 {
            font-size: 28px;
            font-weight: 700;
            margin: 0 0 10px 0;
        }

        .filter-section {
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .filter-group label {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .filter-group input {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 14px;
        }

        .btn-filter {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
        }

        .btn-filter:hover {
            opacity: 0.9;
        }

        .info-box {
            background: #dbeafe;
            color: #1e40af;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #93c5fd;
        }

        .error-message {
            background: #fee2e2;
            color: #991b1b;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #fecaca;
        }

        .matrix-section {
            background: var(--bg-secondary);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            overflow-x: auto;
        }

        .matrix-section h2 {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0 0 20px 0;
        }

        .correlation-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        .correlation-table th,
        .correlation-table td {
            padding: 12px;
            text-align: center;
            border: 1px solid #e5e7eb;
        }

        .correlation-table th {
            background: #f3f4f6;
            font-weight: 600;
            color: #374151;
        }

        .correlation-table td {
            font-weight: 500;
        }

        .corr-strong-positive {
            background-color: #10b981;
            color: white;
        }

        .corr-moderate-positive {
            background-color: #86efac;
            color: #064e3b;
        }

        .corr-weak-positive {
            background-color: #d1fae5;
            color: #065f46;
        }

        .corr-neutral {
            background-color: #f3f4f6;
            color: #374151;
        }

        .corr-weak-negative {
            background-color: #fecaca;
            color: #7f1d1d;
        }

        .corr-moderate-negative {
            background-color: #f87171;
            color: white;
        }

        .corr-strong-negative {
            background-color: #dc2626;
            color: white;
        }

        .legend-section {
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .legend-section h3 {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0 0 15px 0;
        }

        .legend-items {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .legend-color {
            width: 40px;
            height: 20px;
            border-radius: 4px;
        }

        .legend-label {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }
    </style>
</head>
<body>
    <div layout:fragment="content">
        <div class="correlation-container">
            <div class="correlation-header">
                <h1>ğŸ“Š ìƒê´€ê´€ê³„ ë¶„ì„</h1>
                <p>ì „ëµ ê°„ ìƒê´€ê´€ê³„ë¥¼ ë¶„ì„í•˜ì—¬ í¬íŠ¸í´ë¦¬ì˜¤ ë‹¤ê°í™”ë¥¼ í‰ê°€í•©ë‹ˆë‹¤</p>
            </div>

            <div th:if="${error}" class="error-message">
                <span th:text="${error}">ì˜¤ë¥˜ ë©”ì‹œì§€</span>
            </div>

            <div class="info-box">
                <strong>â„¹ï¸ ìƒê´€ê³„ìˆ˜ë€?</strong> ë‘ ì „ëµì˜ ìˆ˜ìµë¥ ì´ ì–¼ë§ˆë‚˜ í•¨ê»˜ ì›€ì§ì´ëŠ”ì§€ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ì§€í‘œì…ë‹ˆë‹¤.
                +1ì— ê°€ê¹Œìš°ë©´ ê°™ì´ ì›€ì§ì´ê³ , -1ì— ê°€ê¹Œìš°ë©´ ë°˜ëŒ€ë¡œ ì›€ì§ì´ë©°, 0ì— ê°€ê¹Œìš°ë©´ ë…ë¦½ì ìœ¼ë¡œ ì›€ì§ì…ë‹ˆë‹¤.
            </div>

            <!-- í•„í„° ì„¹ì…˜ -->
            <form method="get" th:action="@{/trading/risk/correlation}">
                <div class="filter-section">
                    <div class="filter-group">
                        <label>ì‹œì‘ì¼</label>
                        <input type="date" name="startDate" th:value="${startDate}" required>
                    </div>

                    <div class="filter-group">
                        <label>ì¢…ë£Œì¼</label>
                        <input type="date" name="endDate" th:value="${endDate}" required>
                    </div>

                    <button type="submit" class="btn-filter">ğŸ“Š ë¶„ì„</button>
                </div>
            </form>

            <!-- ë²”ë¡€ ì„¹ì…˜ -->
            <div class="legend-section" th:if="${correlationMatrix != null}">
                <h3>ìƒê´€ê³„ìˆ˜ ë²”ë¡€</h3>
                <div class="legend-items">
                    <div class="legend-item">
                        <div class="legend-color corr-strong-positive"></div>
                        <div class="legend-label">ê°•í•œ ì–‘ì˜ ìƒê´€ (0.7 ~ 1.0)</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color corr-moderate-positive"></div>
                        <div class="legend-label">ì¤‘ê°„ ì–‘ì˜ ìƒê´€ (0.3 ~ 0.7)</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color corr-weak-positive"></div>
                        <div class="legend-label">ì•½í•œ ì–‘ì˜ ìƒê´€ (0.0 ~ 0.3)</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color corr-neutral"></div>
                        <div class="legend-label">ë¬´ìƒê´€ (0.0)</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color corr-weak-negative"></div>
                        <div class="legend-label">ì•½í•œ ìŒì˜ ìƒê´€ (-0.3 ~ 0.0)</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color corr-moderate-negative"></div>
                        <div class="legend-label">ì¤‘ê°„ ìŒì˜ ìƒê´€ (-0.7 ~ -0.3)</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color corr-strong-negative"></div>
                        <div class="legend-label">ê°•í•œ ìŒì˜ ìƒê´€ (-1.0 ~ -0.7)</div>
                    </div>
                </div>
            </div>

            <!-- ìƒê´€ê´€ê³„ ë§¤íŠ¸ë¦­ìŠ¤ -->
            <div class="matrix-section" th:if="${correlationMatrix != null && strategies != null}">
                <h2>ì „ëµ ê°„ ìƒê´€ê´€ê³„ ë§¤íŠ¸ë¦­ìŠ¤</h2>
                <table class="correlation-table">
                    <thead>
                        <tr>
                            <th>ì „ëµ</th>
                            <th th:each="strategy : ${strategies}" th:text="${strategy}">ì „ëµ1</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="rowStrategy, rowStat : ${strategies}">
                            <th th:text="${rowStrategy}">ì „ëµ1</th>
                            <td th:each="colStrategy, colStat : ${strategies}"
                                th:with="corrValue=${correlationMatrix[rowStat.index][colStat.index]}"
                                th:text="${#numbers.formatDecimal(corrValue, 1, 'COMMA', 2, 'POINT')}"
                                th:classappend="${corrValue >= 0.7} ? 'corr-strong-positive' :
                                                ${corrValue >= 0.3} ? 'corr-moderate-positive' :
                                                ${corrValue > 0.0} ? 'corr-weak-positive' :
                                                ${corrValue == 0.0} ? 'corr-neutral' :
                                                ${corrValue > -0.3} ? 'corr-weak-negative' :
                                                ${corrValue > -0.7} ? 'corr-moderate-negative' :
                                                'corr-strong-negative'">
                                1.00
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- ì¸ì‚¬ì´íŠ¸ ì„¹ì…˜ -->
            <div class="matrix-section" th:if="${correlationMatrix != null}">
                <h2>ğŸ’¡ í¬íŠ¸í´ë¦¬ì˜¤ ë‹¤ê°í™” ì¸ì‚¬ì´íŠ¸</h2>
                <div style="line-height: 1.8; color: #374151;">
                    <p><strong>ë‚®ì€ ìƒê´€ê´€ê³„ (0ì— ê°€ê¹Œìš´ ê°’):</strong> ì „ëµë“¤ì´ ë…ë¦½ì ìœ¼ë¡œ ì›€ì§ì—¬ ë¦¬ìŠ¤í¬ ë¶„ì‚°ì— ìœ ë¦¬í•©ë‹ˆë‹¤.</p>
                    <p><strong>ë†’ì€ ì–‘ì˜ ìƒê´€ê´€ê³„ (1ì— ê°€ê¹Œìš´ ê°’):</strong> ì „ëµë“¤ì´ ë¹„ìŠ·í•˜ê²Œ ì›€ì§ì—¬ ë¦¬ìŠ¤í¬ê°€ ì§‘ì¤‘ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                    <p><strong>ìŒì˜ ìƒê´€ê´€ê³„ (-1ì— ê°€ê¹Œìš´ ê°’):</strong> ì „ëµë“¤ì´ ë°˜ëŒ€ë¡œ ì›€ì§ì—¬ ì†ì‹¤ì„ ìƒì‡„í•˜ëŠ” íš¨ê³¼ê°€ ìˆìŠµë‹ˆë‹¤.</p>
                </div>
            </div>

            <div th:if="${correlationMatrix == null}" class="empty-state">
                ì¡°íšŒëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ê¸°ê°„ì„ ì¡°ì •í•˜ê±°ë‚˜ ì „ëµ ì‹¤í–‰ ë°ì´í„°ê°€ ì¶©ë¶„í•œì§€ í™•ì¸í•´ ì£¼ì„¸ìš”.
            </div>
        </div>
    </div>
</body>
</html>
