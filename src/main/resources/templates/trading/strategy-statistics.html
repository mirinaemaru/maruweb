<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/main}">
<head>
    <title>ì „ëµë³„ í†µê³„</title>
    <style>
        .statistics-container {
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .statistics-header {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .statistics-header h1 {
            font-size: 28px;
            font-weight: 700;
            margin: 0 0 10px 0;
        }

        .filter-section {
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .filter-group label {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .filter-group input {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 14px;
        }

        .btn-filter {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 10px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
        }

        .btn-filter:hover {
            opacity: 0.9;
        }

        .summary-section {
            background: var(--bg-secondary);
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .summary-section h2 {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0 0 15px 0;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .summary-item {
            padding: 15px;
            background: var(--bg-tertiary);
            border-radius: 8px;
        }

        .summary-item label {
            font-size: 13px;
            color: var(--text-secondary);
            display: block;
            margin-bottom: 5px;
        }

        .summary-item .value {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .summary-item .value.positive {
            color: #10b981;
        }

        .summary-item .value.negative {
            color: #ef4444;
        }

        .strategy-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }

        .strategy-card {
            background: var(--bg-secondary);
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .strategy-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
        }

        .strategy-card-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
        }
            [data-theme="dark"] .strategy-card-header {
                background: linear-gradient(135deg, #2a2d4a 0%, #1e2139 100%);
                box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
                border: 1px solid rgba(255, 255, 255, 0.1);
            }

        .strategy-name {
            font-size: 18px;
            font-weight: 700;
            margin: 0 0 5px 0;
        }

        .strategy-id {
            font-size: 13px;
            opacity: 0.9;
        }

        .strategy-card-body {
            padding: 20px;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .stat-row:last-child {
            border-bottom: none;
        }

        .stat-label {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .stat-value {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .stat-value.positive {
            color: #10b981;
        }

        .stat-value.negative {
            color: #ef4444;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-badge.active {
            background: #d1fae5;
            color: #065f46;
        }

        .status-badge.inactive {
            background: #fee2e2;
            color: #991b1b;
        }

        .error-message {
            background: #fee2e2;
            color: #991b1b;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #fecaca;
        }

        .no-data {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
            background: var(--bg-secondary);
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .no-data-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }

        /* ë·° ì „í™˜ ë²„íŠ¼ */
        .view-toggle {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            background: var(--bg-secondary);
            padding: 8px;
            border-radius: 12px;
            width: fit-content;
        }

        .view-toggle-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            background: transparent;
            color: var(--text-secondary);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .view-toggle-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .view-toggle-btn:hover:not(.active) {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        [data-theme="dark"] .view-toggle-btn.active {
            background: #4a5568;
        }

        /* ë¹„êµ í…Œì´ë¸” */
        .table-section {
            display: none;
            background: var(--bg-secondary);
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
            margin-bottom: 20px;
        }

        .table-section.active {
            display: block;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 14px 16px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .comparison-table th {
            background: var(--bg-tertiary);
            font-weight: 600;
            color: var(--text-secondary);
            cursor: pointer;
            user-select: none;
            white-space: nowrap;
        }

        .comparison-table th:hover {
            background: var(--bg-primary);
        }

        .comparison-table th .sort-icon {
            margin-left: 4px;
            opacity: 0.5;
        }

        .comparison-table th.sorted .sort-icon {
            opacity: 1;
        }

        .comparison-table tbody tr:hover {
            background: var(--bg-tertiary);
        }

        .comparison-table td.positive {
            color: #10b981;
            font-weight: 600;
        }

        .comparison-table td.negative {
            color: #ef4444;
            font-weight: 600;
        }

        .comparison-table .strategy-name-cell {
            font-weight: 600;
            color: var(--text-primary);
        }

        /* ì°¨íŠ¸ ì„¹ì…˜ */
        .charts-section {
            display: none;
            margin-bottom: 20px;
        }

        .charts-section.active {
            display: block;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 900px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
        }

        .chart-card {
            background: var(--bg-secondary);
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 20px;
        }

        .chart-card h3 {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0 0 15px 0;
        }

        .chart-card.full-width {
            grid-column: 1 / -1;
        }

        .chart-container {
            position: relative;
            height: 300px;
        }

        .chart-container.radar {
            height: 350px;
        }

        /* ì¹´ë“œ ë·° (ê¸°ë³¸) */
        .cards-section {
            display: block;
        }

        .cards-section.hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div layout:fragment="content">
        <div class="statistics-container">
            <div class="statistics-header">
                <h1>ğŸ“ˆ ì „ëµë³„ í†µê³„</h1>
                <p>ê° ì „ëµì˜ ì„±ê³¼ë¥¼ ë¹„êµ ë¶„ì„í•©ë‹ˆë‹¤</p>
            </div>

            <div th:if="${error}" class="error-message">
                <span th:text="${error}">ì˜¤ë¥˜ ë©”ì‹œì§€</span>
            </div>

            <!-- í•„í„° ì„¹ì…˜ -->
            <form method="get" th:action="@{/trading/performance/strategies}">
                <div class="filter-section">
                    <div class="filter-group">
                        <label>ì‹œì‘ì¼</label>
                        <input type="date" name="startDate" th:value="${startDate}" required>
                    </div>

                    <div class="filter-group">
                        <label>ì¢…ë£Œì¼</label>
                        <input type="date" name="endDate" th:value="${endDate}" required>
                    </div>

                    <button type="submit" class="btn-filter">ğŸ“Š ì¡°íšŒ</button>
                </div>
            </form>

            <!-- ì „ì²´ ìš”ì•½ -->
            <div class="summary-section" th:if="${summary != null}">
                <h2>ì „ì²´ ìš”ì•½</h2>
                <div class="summary-grid">
                    <div class="summary-item">
                        <label>ì´ ì „ëµ ìˆ˜</label>
                        <div class="value" th:text="${summary['totalStrategies'] ?: 0}">0</div>
                    </div>
                    <div class="summary-item">
                        <label>í™œì„± ì „ëµ</label>
                        <div class="value" th:text="${summary['activeStrategies'] ?: 0}">0</div>
                    </div>
                    <div class="summary-item">
                        <label>ì´ ê±°ë˜ íšŸìˆ˜</label>
                        <div class="value" th:text="${summary['totalTrades'] ?: 0}">0</div>
                    </div>
                    <div class="summary-item">
                        <label>ì „ì²´ ìˆ˜ìµ/ì†ì‹¤</label>
                        <div class="value"
                             th:classappend="${(summary['totalProfitLoss'] ?: 0) >= 0} ? 'positive' : 'negative'"
                             th:text="${#numbers.formatDecimal(summary['totalProfitLoss'] ?: 0, 0, 'COMMA', 0, 'POINT')} + 'ì›'">
                            0ì›
                        </div>
                    </div>
                    <div class="summary-item">
                        <label>í‰ê·  ìŠ¹ë¥ </label>
                        <div class="value" th:text="${#numbers.formatDecimal(summary['avgWinRate'] ?: 0, 1, 'COMMA', 2, 'POINT')} + '%'">0%</div>
                    </div>
                </div>
            </div>

            <!-- ë·° ì „í™˜ ë²„íŠ¼ -->
            <div class="view-toggle" th:if="${strategies != null && !#lists.isEmpty(strategies)}">
                <button type="button" class="view-toggle-btn active" data-view="cards">ğŸ“Š ì¹´ë“œ ë·°</button>
                <button type="button" class="view-toggle-btn" data-view="table">ğŸ“‹ í…Œì´ë¸” ë·°</button>
                <button type="button" class="view-toggle-btn" data-view="charts">ğŸ“ˆ ì°¨íŠ¸ ë·°</button>
            </div>

            <!-- ë¹„êµ í…Œì´ë¸” ì„¹ì…˜ -->
            <div class="table-section" th:if="${strategies != null && !#lists.isEmpty(strategies)}">
                <table class="comparison-table" id="comparisonTable">
                    <thead>
                        <tr>
                            <th data-sort="name" class="sorted">ì „ëµëª… <span class="sort-icon">â–¼</span></th>
                            <th data-sort="status">ìƒíƒœ <span class="sort-icon">â–¼</span></th>
                            <th data-sort="totalTrades">ì´ ê±°ë˜ <span class="sort-icon">â–¼</span></th>
                            <th data-sort="winRate">ìŠ¹ë¥  <span class="sort-icon">â–¼</span></th>
                            <th data-sort="totalProfitLoss">ì´ ì†ìµ <span class="sort-icon">â–¼</span></th>
                            <th data-sort="avgProfitLoss">í‰ê·  ì†ìµ <span class="sort-icon">â–¼</span></th>
                            <th data-sort="maxProfit">ìµœëŒ€ ì´ìµ <span class="sort-icon">â–¼</span></th>
                            <th data-sort="maxLoss">ìµœëŒ€ ì†ì‹¤ <span class="sort-icon">â–¼</span></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="strategy : ${strategies}">
                            <td class="strategy-name-cell" th:text="${strategy['name']}">ì „ëµëª…</td>
                            <td>
                                <span class="status-badge"
                                      th:classappend="${strategy['status'] == 'ACTIVE'} ? 'active' : 'inactive'"
                                      th:text="${strategy['status'] == 'ACTIVE'} ? 'í™œì„±' : 'ë¹„í™œì„±'">í™œì„±</span>
                            </td>
                            <td th:text="${strategy['totalTrades'] ?: 0}"
                                th:data-value="${strategy['totalTrades'] ?: 0}">0</td>
                            <td th:text="${#numbers.formatDecimal(strategy['winRate'] ?: 0, 1, 'COMMA', 2, 'POINT')} + '%'"
                                th:data-value="${strategy['winRate'] ?: 0}">0%</td>
                            <td th:classappend="${(strategy['totalProfitLoss'] ?: 0) >= 0} ? 'positive' : 'negative'"
                                th:text="${#numbers.formatDecimal(strategy['totalProfitLoss'] ?: 0, 0, 'COMMA', 0, 'POINT')} + 'ì›'"
                                th:data-value="${strategy['totalProfitLoss'] ?: 0}">0ì›</td>
                            <td th:classappend="${(strategy['avgProfitLoss'] ?: 0) >= 0} ? 'positive' : 'negative'"
                                th:text="${#numbers.formatDecimal(strategy['avgProfitLoss'] ?: 0, 0, 'COMMA', 0, 'POINT')} + 'ì›'"
                                th:data-value="${strategy['avgProfitLoss'] ?: 0}">0ì›</td>
                            <td class="positive"
                                th:text="${#numbers.formatDecimal(strategy['maxProfit'] ?: 0, 0, 'COMMA', 0, 'POINT')} + 'ì›'"
                                th:data-value="${strategy['maxProfit'] ?: 0}">0ì›</td>
                            <td class="negative"
                                th:text="${#numbers.formatDecimal(strategy['maxLoss'] ?: 0, 0, 'COMMA', 0, 'POINT')} + 'ì›'"
                                th:data-value="${strategy['maxLoss'] ?: 0}">0ì›</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- ì°¨íŠ¸ ì„¹ì…˜ -->
            <div class="charts-section" th:if="${strategies != null && !#lists.isEmpty(strategies)}">
                <div class="charts-grid">
                    <div class="chart-card">
                        <h3>ğŸ’° ì´ ìˆ˜ìµ/ì†ì‹¤ ë¹„êµ</h3>
                        <div class="chart-container">
                            <canvas id="profitLossChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-card">
                        <h3>ğŸ¯ ìŠ¹ë¥  ë¹„êµ</h3>
                        <div class="chart-container">
                            <canvas id="winRateChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-card full-width">
                        <h3>ğŸ“Š ì¢…í•© ì„±ê³¼ ë ˆì´ë” (ìƒìœ„ 5ê°œ ì „ëµ)</h3>
                        <div class="chart-container radar">
                            <canvas id="radarChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ì „ëµ ì¹´ë“œ -->
            <div class="strategy-cards cards-section" th:if="${strategies != null && !#lists.isEmpty(strategies)}">
                <div class="strategy-card" th:each="strategy : ${strategies}">
                    <div class="strategy-card-header">
                        <div class="strategy-name" th:text="${strategy['name']}">ì „ëµëª…</div>
                        <div class="strategy-id">
                            <span th:text="'ID: ' + ${strategy['id']}">ID: 1</span>
                            <span class="status-badge"
                                  th:classappend="${strategy['status'] == 'ACTIVE'} ? 'active' : 'inactive'"
                                  th:text="${strategy['status'] == 'ACTIVE'} ? 'í™œì„±' : 'ë¹„í™œì„±'">
                                í™œì„±
                            </span>
                        </div>
                    </div>
                    <div class="strategy-card-body">
                        <div class="stat-row">
                            <span class="stat-label">ì´ ê±°ë˜</span>
                            <span class="stat-value" th:text="${strategy['totalTrades'] ?: 0}">0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">ìŠ¹ë¦¬</span>
                            <span class="stat-value positive" th:text="${strategy['winningTrades'] ?: 0}">0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">íŒ¨ë°°</span>
                            <span class="stat-value negative" th:text="${strategy['losingTrades'] ?: 0}">0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">ìŠ¹ë¥ </span>
                            <span class="stat-value" th:text="${#numbers.formatDecimal(strategy['winRate'] ?: 0, 1, 'COMMA', 2, 'POINT')} + '%'">0%</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">ì´ ìˆ˜ìµ/ì†ì‹¤</span>
                            <span class="stat-value"
                                  th:classappend="${(strategy['totalProfitLoss'] ?: 0) >= 0} ? 'positive' : 'negative'"
                                  th:text="${#numbers.formatDecimal(strategy['totalProfitLoss'] ?: 0, 0, 'COMMA', 0, 'POINT')} + 'ì›'">
                                0ì›
                            </span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">í‰ê·  ìˆ˜ìµ/ì†ì‹¤</span>
                            <span class="stat-value"
                                  th:classappend="${(strategy['avgProfitLoss'] ?: 0) >= 0} ? 'positive' : 'negative'"
                                  th:text="${#numbers.formatDecimal(strategy['avgProfitLoss'] ?: 0, 0, 'COMMA', 0, 'POINT')} + 'ì›'">
                                0ì›
                            </span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">ìµœëŒ€ ì´ìµ</span>
                            <span class="stat-value positive" th:text="${#numbers.formatDecimal(strategy['maxProfit'] ?: 0, 0, 'COMMA', 0, 'POINT')} + 'ì›'">0ì›</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">ìµœëŒ€ ì†ì‹¤</span>
                            <span class="stat-value negative" th:text="${#numbers.formatDecimal(strategy['maxLoss'] ?: 0, 0, 'COMMA', 0, 'POINT')} + 'ì›'">0ì›</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ë°ì´í„° ì—†ìŒ -->
            <div th:if="${strategies == null || #lists.isEmpty(strategies)}" class="no-data">
                <div class="no-data-icon">ğŸ“Š</div>
                <h3>ì¡°íšŒëœ ì „ëµì´ ì—†ìŠµë‹ˆë‹¤</h3>
                <p>ê¸°ê°„ì„ ì¡°ì •í•˜ê±°ë‚˜ ì „ëµì„ ì¶”ê°€í•´ ì£¼ì„¸ìš”.</p>
            </div>
        </div>

        <!-- Chart.js CDN -->
        <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

        <script th:inline="javascript" th:if="${strategies != null && !#lists.isEmpty(strategies)}">
            // ì „ëµ ë°ì´í„°ë¥¼ JavaScript ë°°ì—´ë¡œ ë³€í™˜
            const strategiesData = /*[[${strategies}]]*/ [];

            // Chart.js ê¸°ë³¸ ì„¤ì •
            Chart.defaults.font.family = "'Pretendard', -apple-system, BlinkMacSystemFont, sans-serif";
            Chart.defaults.color = getComputedStyle(document.documentElement).getPropertyValue('--text-secondary').trim() || '#6b7280';

            // ìƒ‰ìƒ íŒ”ë ˆíŠ¸
            const colors = {
                profit: '#10b981',
                loss: '#ef4444',
                primary: '#667eea',
                chartColors: ['#667eea', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6']
            };

            // ë‹¤í¬ëª¨ë“œ ê°ì§€
            const isDarkMode = () => document.documentElement.getAttribute('data-theme') === 'dark';

            // ìˆ˜ìµ/ì†ì‹¤ ì°¨íŠ¸
            const profitLossCtx = document.getElementById('profitLossChart');
            if (profitLossCtx) {
                const profitLossData = strategiesData.map(s => s.totalProfitLoss);
                const profitLossColors = profitLossData.map(v => v >= 0 ? colors.profit : colors.loss);

                new Chart(profitLossCtx, {
                    type: 'bar',
                    data: {
                        labels: strategiesData.map(s => s.name),
                        datasets: [{
                            label: 'ì´ ì†ìµ (ì›)',
                            data: profitLossData,
                            backgroundColor: profitLossColors,
                            borderColor: profitLossColors,
                            borderWidth: 1,
                            borderRadius: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                callbacks: {
                                    label: (ctx) => `${ctx.parsed.y.toLocaleString()}ì›`
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: (value) => value.toLocaleString() + 'ì›'
                                },
                                grid: {
                                    color: isDarkMode() ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)'
                                }
                            },
                            x: {
                                grid: { display: false }
                            }
                        }
                    }
                });
            }

            // ìŠ¹ë¥  ì°¨íŠ¸
            const winRateCtx = document.getElementById('winRateChart');
            if (winRateCtx) {
                new Chart(winRateCtx, {
                    type: 'bar',
                    data: {
                        labels: strategiesData.map(s => s.name),
                        datasets: [{
                            label: 'ìŠ¹ë¥  (%)',
                            data: strategiesData.map(s => s.winRate),
                            backgroundColor: colors.primary,
                            borderColor: colors.primary,
                            borderWidth: 1,
                            borderRadius: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                callbacks: {
                                    label: (ctx) => `${ctx.parsed.y.toFixed(2)}%`
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100,
                                ticks: {
                                    callback: (value) => value + '%'
                                },
                                grid: {
                                    color: isDarkMode() ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)'
                                }
                            },
                            x: {
                                grid: { display: false }
                            }
                        }
                    }
                });
            }

            // ë ˆì´ë” ì°¨íŠ¸ (ìƒìœ„ 5ê°œ ì „ëµ)
            const radarCtx = document.getElementById('radarChart');
            if (radarCtx) {
                // ì´ ì†ìµ ê¸°ì¤€ ìƒìœ„ 5ê°œ ì „ëµ ì„ íƒ
                const top5 = [...strategiesData]
                    .sort((a, b) => b.totalProfitLoss - a.totalProfitLoss)
                    .slice(0, 5);

                // ì •ê·œí™”ë¥¼ ìœ„í•œ ìµœëŒ€ê°’ ê³„ì‚°
                const maxValues = {
                    winRate: 100,
                    totalTrades: Math.max(...strategiesData.map(s => s.totalTrades)) || 1,
                    totalProfitLoss: Math.max(...strategiesData.map(s => Math.abs(s.totalProfitLoss))) || 1,
                    avgProfitLoss: Math.max(...strategiesData.map(s => Math.abs(s.avgProfitLoss))) || 1,
                    maxProfit: Math.max(...strategiesData.map(s => s.maxProfit)) || 1
                };

                // ì •ê·œí™” í•¨ìˆ˜ (0-100 ìŠ¤ì¼€ì¼)
                const normalize = (value, max) => Math.min(100, Math.max(0, (value / max) * 100));

                const radarDatasets = top5.map((strategy, idx) => ({
                    label: strategy.name,
                    data: [
                        normalize(strategy.winRate, maxValues.winRate),
                        normalize(strategy.totalTrades, maxValues.totalTrades),
                        normalize(Math.max(0, strategy.totalProfitLoss), maxValues.totalProfitLoss),
                        normalize(Math.max(0, strategy.avgProfitLoss), maxValues.avgProfitLoss),
                        normalize(strategy.maxProfit, maxValues.maxProfit)
                    ],
                    fill: true,
                    backgroundColor: colors.chartColors[idx] + '33',
                    borderColor: colors.chartColors[idx],
                    borderWidth: 2,
                    pointBackgroundColor: colors.chartColors[idx]
                }));

                new Chart(radarCtx, {
                    type: 'radar',
                    data: {
                        labels: ['ìŠ¹ë¥ ', 'ê±°ë˜ìˆ˜', 'ì´ ì†ìµ', 'í‰ê·  ì†ìµ', 'ìµœëŒ€ ì´ìµ'],
                        datasets: radarDatasets
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: { padding: 20 }
                            }
                        },
                        scales: {
                            r: {
                                beginAtZero: true,
                                max: 100,
                                ticks: {
                                    stepSize: 20,
                                    display: false
                                },
                                grid: {
                                    color: isDarkMode() ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)'
                                },
                                angleLines: {
                                    color: isDarkMode() ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)'
                                },
                                pointLabels: {
                                    font: { size: 12, weight: '600' }
                                }
                            }
                        }
                    }
                });
            }

            // í…Œì´ë¸” ì •ë ¬ ê¸°ëŠ¥
            const comparisonTable = document.getElementById('comparisonTable');
            if (comparisonTable) {
                const headers = comparisonTable.querySelectorAll('th[data-sort]');
                let currentSort = { column: 'name', direction: 'asc' };

                headers.forEach(header => {
                    header.addEventListener('click', () => {
                        const column = header.dataset.sort;
                        const tbody = comparisonTable.querySelector('tbody');
                        const rows = Array.from(tbody.querySelectorAll('tr'));

                        // ì •ë ¬ ë°©í–¥ ê²°ì •
                        if (currentSort.column === column) {
                            currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
                        } else {
                            currentSort.column = column;
                            currentSort.direction = 'asc';
                        }

                        // ì—´ ì¸ë±ìŠ¤ ë§¤í•‘
                        const columnIndex = {
                            name: 0, status: 1, totalTrades: 2, winRate: 3,
                            totalProfitLoss: 4, avgProfitLoss: 5, maxProfit: 6, maxLoss: 7
                        }[column];

                        // ì •ë ¬
                        rows.sort((a, b) => {
                            const cellA = a.cells[columnIndex];
                            const cellB = b.cells[columnIndex];

                            let valA, valB;
                            if (column === 'name' || column === 'status') {
                                valA = cellA.textContent.trim();
                                valB = cellB.textContent.trim();
                            } else {
                                valA = parseFloat(cellA.dataset.value) || 0;
                                valB = parseFloat(cellB.dataset.value) || 0;
                            }

                            let result;
                            if (typeof valA === 'string') {
                                result = valA.localeCompare(valB, 'ko');
                            } else {
                                result = valA - valB;
                            }

                            return currentSort.direction === 'asc' ? result : -result;
                        });

                        // DOM ì—…ë°ì´íŠ¸
                        rows.forEach(row => tbody.appendChild(row));

                        // í—¤ë” ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
                        headers.forEach(h => {
                            h.classList.remove('sorted');
                            h.querySelector('.sort-icon').textContent = 'â–¼';
                        });
                        header.classList.add('sorted');
                        header.querySelector('.sort-icon').textContent = currentSort.direction === 'asc' ? 'â–²' : 'â–¼';
                    });
                });
            }

            // ë·° ì „í™˜ ê¸°ëŠ¥
            const viewToggleBtns = document.querySelectorAll('.view-toggle-btn');
            const cardsSection = document.querySelector('.strategy-cards');
            const tableSection = document.querySelector('.table-section');
            const chartsSection = document.querySelector('.charts-section');

            viewToggleBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const view = btn.dataset.view;

                    // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
                    viewToggleBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');

                    // ì„¹ì…˜ í‘œì‹œ ì „í™˜
                    if (cardsSection) cardsSection.classList.toggle('hidden', view !== 'cards');
                    if (tableSection) tableSection.classList.toggle('active', view === 'table');
                    if (chartsSection) chartsSection.classList.toggle('active', view === 'charts');
                });
            });
        </script>
    </div>
</body>
</html>
