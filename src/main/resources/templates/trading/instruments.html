<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/main}">
<head>
    <title>종목 관리</title>
    <th:block layout:fragment="extra-css">
        <link rel="stylesheet" th:href="@{/css/trading.css}"/>
    </th:block>
</head>
<body>
<div layout:fragment="content">
    <!-- Skip Link for Accessibility -->
    <a href="#instruments-table" class="skip-link">종목 목록으로 바로가기</a>

    <!-- Live Region for Dynamic Updates -->
    <div id="live-region" aria-live="polite" aria-atomic="true" class="sr-only"></div>

    <main class="instruments-container" role="main">
        <header class="page-header">
            <h1>
                <span aria-hidden="true"><i class="bi bi-graph-up me-2"></i></span>
                <span>종목 관리</span>
                <span class="badge bg-secondary ms-3"
                      role="status"
                      th:aria-label="${'총 ' + #numbers.formatInteger(total, 0, 'COMMA') + '개 종목'}"
                      th:text="'총 ' + ${#numbers.formatInteger(total, 0, 'COMMA')} + '개'"></span>
            </h1>
        </header>

        <!-- Alert Messages -->
        <div th:if="${successMessage}"
             class="alert alert-success alert-dismissible fade show"
             role="alert"
             aria-live="polite">
            <span aria-hidden="true"><i class="bi bi-check-circle me-2"></i></span>
            <span th:text="${successMessage}"></span>
            <button type="button"
                    class="btn-close"
                    data-bs-dismiss="alert"
                    aria-label="알림 닫기"></button>
        </div>
        <div th:if="${errorMessage}"
             class="alert alert-danger alert-dismissible fade show"
             role="alert"
             aria-live="assertive">
            <span aria-hidden="true"><i class="bi bi-exclamation-triangle me-2"></i></span>
            <span th:text="${errorMessage}"></span>
            <button type="button"
                    class="btn-close"
                    data-bs-dismiss="alert"
                    aria-label="알림 닫기"></button>
        </div>
        <div th:if="${error}"
             class="alert alert-warning alert-dismissible fade show"
             role="alert"
             aria-live="polite">
            <span aria-hidden="true"><i class="bi bi-exclamation-triangle me-2"></i></span>
            <span th:text="${error}"></span>
            <button type="button"
                    class="btn-close"
                    data-bs-dismiss="alert"
                    aria-label="알림 닫기"></button>
        </div>

        <!-- Filter Section -->
        <section class="card mb-4" aria-labelledby="filter-heading">
            <div class="card-body">
                <h2 id="filter-heading" class="sr-only">종목 필터</h2>
                <form method="get"
                      action="/trading/instruments"
                      class="filter-form"
                      role="search"
                      aria-label="종목 검색">
                    <div class="filter-item">
                        <label for="market-filter" class="form-label">시장</label>
                        <select id="market-filter"
                                name="market"
                                class="form-select"
                                aria-describedby="market-help">
                            <option value="">전체</option>
                            <option value="KOSPI" th:selected="${selectedMarket == 'KOSPI'}">KOSPI</option>
                            <option value="KOSDAQ" th:selected="${selectedMarket == 'KOSDAQ'}">KOSDAQ</option>
                            <option value="KONEX" th:selected="${selectedMarket == 'KONEX'}">KONEX</option>
                        </select>
                    </div>
                    <div class="filter-item">
                        <label for="status-filter" class="form-label">상태</label>
                        <select id="status-filter"
                                name="status"
                                class="form-select">
                            <option value="">전체</option>
                            <option value="LISTED" th:selected="${selectedStatus == 'LISTED'}">상장</option>
                            <option value="SUSPENDED" th:selected="${selectedStatus == 'SUSPENDED'}">거래정지</option>
                            <option value="DELISTED" th:selected="${selectedStatus == 'DELISTED'}">상장폐지</option>
                        </select>
                    </div>
                    <div class="filter-item">
                        <label for="tradable-filter" class="form-label">거래 가능</label>
                        <select id="tradable-filter"
                                name="tradable"
                                class="form-select">
                            <option value="">전체</option>
                            <option value="true" th:selected="${selectedTradable == true}">거래 가능</option>
                            <option value="false" th:selected="${selectedTradable == false}">거래 불가</option>
                        </select>
                    </div>
                    <div class="filter-item">
                        <label for="search-input" class="form-label">종목 검색</label>
                        <input type="text"
                               id="search-input"
                               name="search"
                               class="form-control"
                               placeholder="종목명 또는 코드"
                               th:value="${searchKeyword}"
                               aria-label="종목명 또는 코드로 검색">
                    </div>
                    <div class="filter-buttons">
                        <button type="submit"
                                class="btn btn-primary"
                                aria-label="종목 검색">
                            <span aria-hidden="true"><i class="bi bi-search me-1"></i></span>검색
                        </button>
                        <a href="/trading/instruments"
                           class="btn btn-outline-secondary"
                           aria-label="필터 초기화">
                            <span aria-hidden="true"><i class="bi bi-arrow-counterclockwise me-1"></i></span>초기화
                        </a>
                    </div>
                </form>
            </div>
        </section>

        <!-- Instruments Table -->
        <section id="instruments-table" class="card" aria-labelledby="instruments-heading">
            <h2 id="instruments-heading" class="sr-only">종목 목록</h2>
            <div class="card-body table-card">
                <div class="table-responsive table-scroll-container" tabindex="0">
                    <table class="table table-hover" aria-describedby="instruments-heading">
                        <caption class="sr-only">
                            종목 목록 테이블 - 종목코드, 종목명, 시장, 상태 등의 정보를 포함합니다.
                        </caption>
                        <thead class="table-light">
                            <tr>
                                <th scope="col" class="col-symbol text-center">종목코드</th>
                                <th scope="col" class="col-name-kr">종목명 (한글)</th>
                                <th scope="col" class="col-name-en">종목명 (영문)</th>
                                <th scope="col" class="col-market text-center">시장</th>
                                <th scope="col" class="col-industry text-center">업종</th>
                                <th scope="col" class="col-status text-center">상태</th>
                                <th scope="col" class="col-tradable text-center">
                                    <span aria-label="거래 가능 여부">거래</span>
                                </th>
                                <th scope="col" class="col-halted text-center">
                                    <span aria-label="거래 정지 여부">정지</span>
                                </th>
                                <th scope="col" class="col-listing text-center">상장일</th>
                                <th scope="col" class="col-action text-center">관리</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:if="${#lists.isEmpty(instruments)}">
                                <td colspan="10" class="text-center text-muted py-4">
                                    <div class="trading-empty" role="status">
                                        <div class="trading-empty-icon" aria-hidden="true">
                                            <i class="bi bi-inbox fs-1 d-block mb-2"></i>
                                        </div>
                                        <p class="trading-empty-title">조회된 종목이 없습니다.</p>
                                    </div>
                                </td>
                            </tr>
                            <tr th:each="inst : ${instruments}">
                                <td class="text-center">
                                    <a th:href="@{/trading/instruments/{symbol}(symbol=${inst.symbol})}"
                                       th:text="${inst.symbol}"
                                       th:aria-label="${inst.nameKr + ' (' + inst.symbol + ') 상세 정보 보기'}"
                                       class="symbol-link"></a>
                                </td>
                                <td th:text="${inst.nameKr}"></td>
                                <td th:text="${inst.nameEn}" class="text-muted small"></td>
                                <td class="text-center" th:text="${inst.market}"></td>
                                <td class="text-center small" th:text="${inst.industry}"></td>
                                <td class="text-center">
                                    <span th:text="${inst.status == 'LISTED'} ? '상장' : (${inst.status == 'SUSPENDED'} ? '거래정지' : '상장폐지')"
                                          th:aria-label="${inst.status == 'LISTED'} ? '상장 상태' : (${inst.status == 'SUSPENDED'} ? '거래정지 상태' : '상장폐지 상태')"></span>
                                </td>
                                <td class="text-center">
                                    <span th:text="${inst.tradable} ? 'Y' : 'N'"
                                          th:aria-label="${inst.tradable} ? '거래 가능' : '거래 불가'"></span>
                                </td>
                                <td class="text-center">
                                    <span th:text="${inst.halted} ? 'Y' : 'N'"
                                          th:aria-label="${inst.halted} ? '거래 정지됨' : '정상 거래'"></span>
                                </td>
                                <td class="text-center small" th:text="${inst.listingDate}"></td>
                                <td class="text-center">
                                    <a th:href="@{/trading/instruments/{symbol}(symbol=${inst.symbol})}"
                                       class="detail-link"
                                       th:aria-label="${inst.nameKr + ' 상세 정보 보기'}">상세</a>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>
    </main>
</div>
</body>
</html>
