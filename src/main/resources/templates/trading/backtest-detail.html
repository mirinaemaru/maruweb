<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/main}">
<head>
    <title>ë°±í…ŒìŠ¤íŒ… ìƒì„¸</title>
    <style>
        .detail-container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 40px;
            border-radius: 16px;
            color: white;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(102, 126, 234, 0.3);
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: var(--bg-secondary);
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .chart-container {
            background: var(--bg-secondary);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .chart-canvas {
            height: 400px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: var(--bg-secondary);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        th {
            background: var(--bg-tertiary);
            padding: 15px;
            text-align: left;
            font-weight: 700;
            color: var(--text-primary);
        }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid var(--border-color);
        }

        /* Dark mode styles */
        [data-theme="dark"] header {
            background: linear-gradient(135deg, #2a2d4a 0%, #1e2139 100%);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        [data-theme="dark"] .metric-card {
            background: var(--bg-secondary);
        }

        [data-theme="dark"] th {
            background: var(--bg-tertiary);
        }

        [data-theme="dark"] .chart-container {
            background: var(--bg-secondary);
        }
    </style>
</head>
<body>
    <div layout:fragment="content">
        <div class="detail-container">
            <header>
                <h1>ğŸ“Š ë°±í…ŒìŠ¤íŒ… ìƒì„¸ ê²°ê³¼</h1>
                <p th:text="${backtest.strategyName}">Strategy Name</p>
            </header>

            <!-- Metrics Grid -->
            <div class="metrics-grid">
                <div class="metric-card">
                    <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 10px;">ì´ ì†ìµ</div>
                    <div style="font-size: 32px; font-weight: 700;" th:text="${#numbers.formatInteger(metrics.totalProfitLoss, 0, 'COMMA')} + 'ì›'">0ì›</div>
                </div>
                <div class="metric-card">
                    <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 10px;">ìŠ¹ë¥ </div>
                    <div style="font-size: 32px; font-weight: 700;" th:text="${#numbers.formatDecimal(metrics.winRate, 1, 1)} + '%'">0.0%</div>
                </div>
                <div class="metric-card">
                    <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 10px;">ì´ ê±°ë˜</div>
                    <div style="font-size: 32px; font-weight: 700;" th:text="${metrics.totalTrades}">0</div>
                </div>
                <div class="metric-card">
                    <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 10px;">ìµœëŒ€ ë‚™í­</div>
                    <div style="font-size: 32px; font-weight: 700;" th:text="${#numbers.formatDecimal(metrics.maxDrawdown, 1, 1)} + '%'">0.0%</div>
                </div>
            </div>

            <!-- Equity Curve Chart -->
            <div class="chart-container">
                <h3>ìì‚° ê³¡ì„ </h3>
                <div class="chart-canvas">
                    <canvas id="equityChart"></canvas>
                </div>
            </div>

            <!-- Trade List -->
            <div style="background: var(--bg-secondary); padding: 30px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                <h3 style="margin-top: 0;">ê±°ë˜ ë‚´ì—­</h3>
                <table>
                    <thead>
                        <tr>
                            <th>ë‚ ì§œ</th>
                            <th>ì¢…ëª©</th>
                            <th>ë°©í–¥</th>
                            <th>ìˆ˜ëŸ‰</th>
                            <th>ì§„ì…ê°€</th>
                            <th>ì²­ì‚°ê°€</th>
                            <th>ì†ìµ</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:if="${trades == null || #lists.isEmpty(trades)}">
                            <td colspan="7" style="text-align: center; color: var(--text-muted);">ê±°ë˜ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</td>
                        </tr>
                        <tr th:each="trade : ${trades}">
                            <td th:text="${trade.date}">2024-01-01</td>
                            <td th:text="${trade.symbol}">Symbol</td>
                            <td th:text="${trade.side}">BUY</td>
                            <td th:text="${trade.quantity}">100</td>
                            <td th:text="${#numbers.formatInteger(trade.entryPrice, 0, 'COMMA')}">75,000</td>
                            <td th:text="${#numbers.formatInteger(trade.exitPrice, 0, 'COMMA')}">76,000</td>
                            <td th:style="'color:' + ${trade.profitLoss >= 0 ? '#28a745' : '#dc3545'}" th:text="${#numbers.formatInteger(trade.profitLoss, 0, 'COMMA')}">+100,000</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script th:fragment="extra-scripts">
        const equityData = /*[[${equityCurve}]]*/ [];
        const ctx = document.getElementById('equityChart');

        if (ctx && equityData && equityData.length > 0) {
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: equityData.map(d => d.date),
                    datasets: [{
                        label: 'ìì‚° (ì›)',
                        data: equityData.map(d => d.equity),
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false,
                            ticks: {
                                callback: v => new Intl.NumberFormat('ko-KR').format(v) + 'ì›'
                            }
                        }
                    }
                }
            });
        }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</body>
</html>
